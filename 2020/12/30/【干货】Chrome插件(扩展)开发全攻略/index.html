<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>【干货】Chrome插件(扩展)开发全攻略 - 蛋清小记</title><meta description="写在前面我花了将近一个多月的时间断断续续写下这篇博文，并精心写下完整demo，所以转载务必保留 http:&amp;#x2F;&amp;#x2F;blog.haoji.me&amp;#x2F;chrome-plugin-develop.html 。本文所有涉及到的大部分代码均在这个demo里面：https:&amp;#x2F;&amp;#x2F;github.com&amp;#x2F;sxei&amp;#x2F;chrome-plugin-demo ，大家可以直接下载下来运行。"><meta property="og:type" content="blog"><meta property="og:title" content="【干货】Chrome插件(扩展)开发全攻略"><meta property="og:url" content="http://yoursite.com/2020/12/30/%E3%80%90%E5%B9%B2%E8%B4%A7%E3%80%91Chrome%E6%8F%92%E4%BB%B6(%E6%89%A9%E5%B1%95)%E5%BC%80%E5%8F%91%E5%85%A8%E6%94%BB%E7%95%A5/"><meta property="og:site_name" content="蛋清小记"><meta property="og:description" content="写在前面我花了将近一个多月的时间断断续续写下这篇博文，并精心写下完整demo，所以转载务必保留 http:&amp;#x2F;&amp;#x2F;blog.haoji.me&amp;#x2F;chrome-plugin-develop.html 。本文所有涉及到的大部分代码均在这个demo里面：https:&amp;#x2F;&amp;#x2F;github.com&amp;#x2F;sxei&amp;#x2F;chrome-plugin-demo ，大家可以直接下载下来运行。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://blog.zhangruipeng.me/hexo-theme-icarus/gallery/covers/vector_landscape_1.svg"><meta property="article:published_time" content="2020-12-30T07:06:44.525Z"><meta property="article:modified_time" content="2020-12-30T07:06:44.525Z"><meta property="article:author" content="蛋清小记"><meta property="article:tag" content="跨域"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="https://blog.zhangruipeng.me/hexo-theme-icarus/gallery/covers/vector_landscape_1.svg"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://yoursite.com/2020/12/30/%E3%80%90%E5%B9%B2%E8%B4%A7%E3%80%91Chrome%E6%8F%92%E4%BB%B6(%E6%89%A9%E5%B1%95)%E5%BC%80%E5%8F%91%E5%85%A8%E6%94%BB%E7%95%A5/"},"headline":"蛋清小记","image":[],"datePublished":"2020-12-30T07:06:44.525Z","dateModified":"2020-12-30T07:06:44.525Z","author":{"@type":"Person","name":"蛋清小记"},"description":"写在前面我花了将近一个多月的时间断断续续写下这篇博文，并精心写下完整demo，所以转载务必保留 http:&#x2F;&#x2F;blog.haoji.me&#x2F;chrome-plugin-develop.html 。本文所有涉及到的大部分代码均在这个demo里面：https:&#x2F;&#x2F;github.com&#x2F;sxei&#x2F;chrome-plugin-demo ，大家可以直接下载下来运行。"}</script><link rel="canonical" href="http://yoursite.com/2020/12/30/%E3%80%90%E5%B9%B2%E8%B4%A7%E3%80%91Chrome%E6%8F%92%E4%BB%B6(%E6%89%A9%E5%B1%95)%E5%BC%80%E5%8F%91%E5%85%A8%E6%94%BB%E7%95%A5/"><link rel="icon" href="https://img.alicdn.com/imgextra/i2/3484326495/O1CN010Q7a1S1xql4AaZ5zA_!!3484326495-2-daren.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><meta name="generator" content="Hexo 5.1.1"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="蛋清小记" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">首页</a><a class="navbar-item" href="/archives">归档</a><a class="navbar-item" href="/categories">分类</a><a class="navbar-item" href="/tags">标签</a></div><div class="navbar-end"><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2020-12-30T07:06:44.525Z" title="2020-12-30T07:06:44.525Z">2020-12-30</time>发表</span><span class="level-item"><time dateTime="2020-12-30T07:06:44.525Z" title="2020-12-30T07:06:44.525Z">2020-12-30</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/Chrome%E6%8F%92%E4%BB%B6/">Chrome插件</a></span><span class="level-item">1 小时读完 (大约10922个字)</span></div></div><h1 class="title is-3 is-size-4-mobile">【干货】Chrome插件(扩展)开发全攻略</h1><div class="content"><h1 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h1><p>我花了将近一个多月的时间断断续续写下这篇博文，并精心写下完整demo，所以转载务必保留 <a target="_blank" rel="noopener" href="http://blog.haoji.me/chrome-plugin-develop.html">http://blog.haoji.me/chrome-plugin-develop.html</a> 。本文所有涉及到的大部分代码均在这个demo里面：<a target="_blank" rel="noopener" href="https://github.com/sxei/chrome-plugin-demo">https://github.com/sxei/chrome-plugin-demo</a> ，大家可以直接下载下来运行。</p>
<a id="more"></a>

<p>另外，本文图片较多，请耐心等待加载完毕。</p>
<p>本文目录：</p>
<p><img src="http://image.liuxianan.com/201707/20170710_222547_735_9922.png"></p>
<p>demo部分截图：</p>
<p><img src="http://image.liuxianan.com/201707/20170710_223150_516_6129.png"></p>
<p>鉴于有很多网友有交流学习Chrome插件的诉求，所以最近建了一个插件开发交流群，仅仅是为了提供一个互相交流学习的平台：</p>
<p><img src="https://img.alicdn.com/tfs/TB1rvUrJpY7gK0jSZKzXXaikpXa-1582-740.png" alt="_W791xH370_"></p>
<h2 id="仓库说明"><a href="#仓库说明" class="headerlink" title="仓库说明"></a>仓库说明</h2><ul>
<li><code>full-chrome-plugin-demo</code>：大部分demo代码都在这个仓库；</li>
<li><code>simple-chrome-plugin-demo</code>：最精简的Chrome仓库模板，当需要快速写一个简单仓库时可以基于这个模板；</li>
<li><code>page-action-demo</code>：关于<code>page-action</code>部分的demo代码，由于这部分代码和<code>full-chrome-plugin-demo</code>冲突，所以单独拿出来；</li>
</ul>
<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><h2 id="什么是Chrome插件"><a href="#什么是Chrome插件" class="headerlink" title="什么是Chrome插件"></a>什么是Chrome插件</h2><p>严格来讲，我们正在说的东西应该叫Chrome扩展(<code>Chrome Extension</code>)，真正意义上的Chrome插件是更底层的浏览器功能扩展，可能需要对浏览器源码有一定掌握才有能力去开发。鉴于Chrome插件的叫法已经习惯，本文也全部采用这种叫法，但读者需深知本文所描述的Chrome插件实际上指的是Chrome扩展。</p>
<p>Chrome插件是一个用Web技术开发、用来增强浏览器功能的软件，它其实就是一个由HTML、CSS、JS、图片等资源组成的一个<a target="_blank" rel="noopener" href="https://developer.chrome.com/extensions/crx">.crx</a>后缀的压缩包.</p>
<p>个人猜测<code>crx</code>可能是<code>Chrome Extension</code>如下3个字母的简写：</p>
<p><img src="http://image.liuxianan.com/201706/20170619_114836_364_3616.png"></p>
<p>另外，其实不只是前端技术，Chrome插件还可以配合C++编写的dll动态链接库实现一些更底层的功能(NPAPI)，比如全屏幕截图。</p>
<p><img src="http://image.liuxianan.com/201706/20170626_112802_406_9027.png" alt="360抢票王插件dll截图"></p>
<blockquote>
<p>由于安全原因，Chrome浏览器42以上版本已经陆续不再支持NPAPI插件，取而代之的是更安全的PPAPI。</p>
</blockquote>
<h2 id="学习Chrome插件开发有什么意义"><a href="#学习Chrome插件开发有什么意义" class="headerlink" title="学习Chrome插件开发有什么意义"></a>学习Chrome插件开发有什么意义</h2><p>增强浏览器功能，轻松实现属于自己的“定制版”浏览器，等等。</p>
<p>Chrome插件提供了很多实用API供我们使用，包括但不限于：</p>
<ul>
<li>书签控制；</li>
<li>下载控制；</li>
<li>窗口控制；</li>
<li>标签控制；</li>
<li>网络请求控制，各类事件监听；</li>
<li>自定义原生菜单；</li>
<li>完善的通信机制；</li>
<li>等等；</li>
</ul>
<h2 id="为什么是Chrome插件而不是Firefox插件"><a href="#为什么是Chrome插件而不是Firefox插件" class="headerlink" title="为什么是Chrome插件而不是Firefox插件"></a>为什么是Chrome插件而不是Firefox插件</h2><ol>
<li>Chrome占有率更高，更多人用；</li>
<li>开发更简单；</li>
<li>应用场景更广泛，Firefox插件只能运行在Firefox上，而Chrome除了Chrome浏览器之外，还可以运行在所有webkit内核的国产浏览器，比如360极速浏览器、360安全浏览器、搜狗浏览器、QQ浏览器等等；</li>
<li>除此之外，Firefox浏览器也对Chrome插件的运行提供了一定的支持；</li>
</ol>
<h1 id="开发与调试"><a href="#开发与调试" class="headerlink" title="开发与调试"></a>开发与调试</h1><p>Chrome插件没有严格的项目结构要求，只要保证本目录有一个<code>manifest.json</code>即可，也不需要专门的IDE，普通的web开发工具即可。</p>
<p>从右上角菜单-&gt;更多工具-&gt;扩展程序可以进入 插件管理页面，也可以直接在地址栏输入 <a href="chrome://extensions/">chrome://extensions</a> 访问。</p>
<p><img src="http://image.liuxianan.com/201706/20170620_195047_992_5668.png"></p>
<p>勾选<code>开发者模式</code>即可以文件夹的形式直接加载插件，否则只能安装<code>.crx</code>格式的文件。Chrome要求插件必须从它的Chrome应用商店安装，其它任何网站下载的都无法直接安装，所以，其实我们可以把<code>crx</code>文件解压，然后通过开发者模式直接加载。</p>
<p>开发中，代码有任何改动都必须重新加载插件，只需要在插件管理页按下<code>Ctrl+R</code>即可，以防万一最好还把页面刷新一下。</p>
<h1 id="核心介绍"><a href="#核心介绍" class="headerlink" title="核心介绍"></a>核心介绍</h1><h2 id="manifest-json"><a href="#manifest-json" class="headerlink" title="manifest.json"></a>manifest.json</h2><p>这是一个Chrome插件最重要也是必不可少的文件，用来配置所有和插件相关的配置，必须放在根目录。其中，<code>manifest_version</code>、<code>name</code>、<code>version</code>3个是必不可少的，<code>description</code>和<code>icons</code>是推荐的。</p>
<p>下面给出的是一些常见的配置项，均有中文注释，完整的配置文档请戳<a target="_blank" rel="noopener" href="https://developer.chrome.com/extensions/manifest">这里</a>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="comment">// 清单文件的版本，这个必须写，而且必须是2</span></span><br><span class="line">	<span class="string">&quot;manifest_version&quot;</span>: <span class="number">2</span>,</span><br><span class="line">	<span class="comment">// 插件的名称</span></span><br><span class="line">	<span class="string">&quot;name&quot;</span>: <span class="string">&quot;demo&quot;</span>,</span><br><span class="line">	<span class="comment">// 插件的版本</span></span><br><span class="line">	<span class="string">&quot;version&quot;</span>: <span class="string">&quot;1.0.0&quot;</span>,</span><br><span class="line">	<span class="comment">// 插件描述</span></span><br><span class="line">	<span class="string">&quot;description&quot;</span>: <span class="string">&quot;简单的Chrome扩展demo&quot;</span>,</span><br><span class="line">	<span class="comment">// 图标，一般偷懒全部用一个尺寸的也没问题</span></span><br><span class="line">	<span class="string">&quot;icons&quot;</span>:</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="string">&quot;16&quot;</span>: <span class="string">&quot;img/icon.png&quot;</span>,</span><br><span class="line">		<span class="string">&quot;48&quot;</span>: <span class="string">&quot;img/icon.png&quot;</span>,</span><br><span class="line">		<span class="string">&quot;128&quot;</span>: <span class="string">&quot;img/icon.png&quot;</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="comment">// 会一直常驻的后台JS或后台页面</span></span><br><span class="line">	<span class="string">&quot;background&quot;</span>:</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">// 2种指定方式，如果指定JS，那么会自动生成一个背景页</span></span><br><span class="line">		<span class="string">&quot;page&quot;</span>: <span class="string">&quot;background.html&quot;</span></span><br><span class="line">		<span class="comment">//&quot;scripts&quot;: [&quot;js/background.js&quot;]</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="comment">// 浏览器右上角图标设置，browser_action、page_action、app必须三选一</span></span><br><span class="line">	<span class="string">&quot;browser_action&quot;</span>: </span><br><span class="line">	&#123;</span><br><span class="line">		<span class="string">&quot;default_icon&quot;</span>: <span class="string">&quot;img/icon.png&quot;</span>,</span><br><span class="line">		<span class="comment">// 图标悬停时的标题，可选</span></span><br><span class="line">		<span class="string">&quot;default_title&quot;</span>: <span class="string">&quot;这是一个示例Chrome插件&quot;</span>,</span><br><span class="line">		<span class="string">&quot;default_popup&quot;</span>: <span class="string">&quot;popup.html&quot;</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="comment">// 当某些特定页面打开才显示的图标</span></span><br><span class="line">	<span class="comment">/*&quot;page_action&quot;:</span></span><br><span class="line"><span class="comment">	&#123;</span></span><br><span class="line"><span class="comment">		&quot;default_icon&quot;: &quot;img/icon.png&quot;,</span></span><br><span class="line"><span class="comment">		&quot;default_title&quot;: &quot;我是pageAction&quot;,</span></span><br><span class="line"><span class="comment">		&quot;default_popup&quot;: &quot;popup.html&quot;</span></span><br><span class="line"><span class="comment">	&#125;,*/</span></span><br><span class="line">	<span class="comment">// 需要直接注入页面的JS</span></span><br><span class="line">	<span class="string">&quot;content_scripts&quot;</span>: </span><br><span class="line">	[</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">//&quot;matches&quot;: [&quot;http://*/*&quot;, &quot;https://*/*&quot;],</span></span><br><span class="line">			<span class="comment">// &quot;&lt;all_urls&gt;&quot; 表示匹配所有地址</span></span><br><span class="line">			<span class="string">&quot;matches&quot;</span>: [<span class="string">&quot;&lt;all_urls&gt;&quot;</span>],</span><br><span class="line">			<span class="comment">// 多个JS按顺序注入</span></span><br><span class="line">			<span class="string">&quot;js&quot;</span>: [<span class="string">&quot;js/jquery-1.8.3.js&quot;</span>, <span class="string">&quot;js/content-script.js&quot;</span>],</span><br><span class="line">			<span class="comment">// JS的注入可以随便一点，但是CSS的注意就要千万小心了，因为一不小心就可能影响全局样式</span></span><br><span class="line">			<span class="string">&quot;css&quot;</span>: [<span class="string">&quot;css/custom.css&quot;</span>],</span><br><span class="line">			<span class="comment">// 代码注入的时间，可选值： &quot;document_start&quot;, &quot;document_end&quot;, or &quot;document_idle&quot;，最后一个表示页面空闲时，默认document_idle</span></span><br><span class="line">			<span class="string">&quot;run_at&quot;</span>: <span class="string">&quot;document_start&quot;</span></span><br><span class="line">		&#125;,</span><br><span class="line">		<span class="comment">// 这里仅仅是为了演示content-script可以配置多个规则</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;matches&quot;</span>: [<span class="string">&quot;*://*/*.png&quot;</span>, <span class="string">&quot;*://*/*.jpg&quot;</span>, <span class="string">&quot;*://*/*.gif&quot;</span>, <span class="string">&quot;*://*/*.bmp&quot;</span>],</span><br><span class="line">			<span class="string">&quot;js&quot;</span>: [<span class="string">&quot;js/show-image-content-size.js&quot;</span>]</span><br><span class="line">		&#125;</span><br><span class="line">	],</span><br><span class="line">	<span class="comment">// 权限申请</span></span><br><span class="line">	<span class="string">&quot;permissions&quot;</span>:</span><br><span class="line">	[</span><br><span class="line">		<span class="string">&quot;contextMenus&quot;</span>, <span class="comment">// 右键菜单</span></span><br><span class="line">		<span class="string">&quot;tabs&quot;</span>, <span class="comment">// 标签</span></span><br><span class="line">		<span class="string">&quot;notifications&quot;</span>, <span class="comment">// 通知</span></span><br><span class="line">		<span class="string">&quot;webRequest&quot;</span>, <span class="comment">// web请求</span></span><br><span class="line">		<span class="string">&quot;webRequestBlocking&quot;</span>,</span><br><span class="line">		<span class="string">&quot;storage&quot;</span>, <span class="comment">// 插件本地存储</span></span><br><span class="line">		<span class="string">&quot;http://*/*&quot;</span>, <span class="comment">// 可以通过executeScript或者insertCSS访问的网站</span></span><br><span class="line">		<span class="string">&quot;https://*/*&quot;</span> <span class="comment">// 可以通过executeScript或者insertCSS访问的网站</span></span><br><span class="line">	],</span><br><span class="line">	<span class="comment">// 普通页面能够直接访问的插件资源列表，如果不设置是无法直接访问的</span></span><br><span class="line">	<span class="string">&quot;web_accessible_resources&quot;</span>: [<span class="string">&quot;js/inject.js&quot;</span>],</span><br><span class="line">	<span class="comment">// 插件主页，这个很重要，不要浪费了这个免费广告位</span></span><br><span class="line">	<span class="string">&quot;homepage_url&quot;</span>: <span class="string">&quot;https://www.baidu.com&quot;</span>,</span><br><span class="line">	<span class="comment">// 覆盖浏览器默认页面</span></span><br><span class="line">	<span class="string">&quot;chrome_url_overrides&quot;</span>:</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">// 覆盖浏览器默认的新标签页</span></span><br><span class="line">		<span class="string">&quot;newtab&quot;</span>: <span class="string">&quot;newtab.html&quot;</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="comment">// Chrome40以前的插件配置页写法</span></span><br><span class="line">	<span class="string">&quot;options_page&quot;</span>: <span class="string">&quot;options.html&quot;</span>,</span><br><span class="line">	<span class="comment">// Chrome40以后的插件配置页写法，如果2个都写，新版Chrome只认后面这一个</span></span><br><span class="line">	<span class="string">&quot;options_ui&quot;</span>:</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="string">&quot;page&quot;</span>: <span class="string">&quot;options.html&quot;</span>,</span><br><span class="line">		<span class="comment">// 添加一些默认的样式，推荐使用</span></span><br><span class="line">		<span class="string">&quot;chrome_style&quot;</span>: <span class="literal">true</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="comment">// 向地址栏注册一个关键字以提供搜索建议，只能设置一个关键字</span></span><br><span class="line">	<span class="string">&quot;omnibox&quot;</span>: &#123; <span class="string">&quot;keyword&quot;</span> : <span class="string">&quot;go&quot;</span> &#125;,</span><br><span class="line">	<span class="comment">// 默认语言</span></span><br><span class="line">	<span class="string">&quot;default_locale&quot;</span>: <span class="string">&quot;zh_CN&quot;</span>,</span><br><span class="line">	<span class="comment">// devtools页面入口，注意只能指向一个HTML文件，不能是JS文件</span></span><br><span class="line">	<span class="string">&quot;devtools_page&quot;</span>: <span class="string">&quot;devtools.html&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="content-scripts"><a href="#content-scripts" class="headerlink" title="content-scripts"></a>content-scripts</h2><p>所谓<a target="_blank" rel="noopener" href="https://developer.chrome.com/extensions/content_scripts">content-scripts</a>，其实就是Chrome插件中向页面注入脚本的一种形式（虽然名为script，其实还可以包括css的），借助<code>content-scripts</code>我们可以实现通过配置的方式轻松向指定页面注入JS和CSS（如果需要动态注入，可以参考下文），最常见的比如：广告屏蔽、页面CSS定制，等等。</p>
<p>示例配置：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="comment">// 需要直接注入页面的JS</span></span><br><span class="line">	<span class="string">&quot;content_scripts&quot;</span>: </span><br><span class="line">	[</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">//&quot;matches&quot;: [&quot;http://*/*&quot;, &quot;https://*/*&quot;],</span></span><br><span class="line">			<span class="comment">// &quot;&lt;all_urls&gt;&quot; 表示匹配所有地址</span></span><br><span class="line">			<span class="string">&quot;matches&quot;</span>: [<span class="string">&quot;&lt;all_urls&gt;&quot;</span>],</span><br><span class="line">			<span class="comment">// 多个JS按顺序注入</span></span><br><span class="line">			<span class="string">&quot;js&quot;</span>: [<span class="string">&quot;js/jquery-1.8.3.js&quot;</span>, <span class="string">&quot;js/content-script.js&quot;</span>],</span><br><span class="line">			<span class="comment">// JS的注入可以随便一点，但是CSS的注意就要千万小心了，因为一不小心就可能影响全局样式</span></span><br><span class="line">			<span class="string">&quot;css&quot;</span>: [<span class="string">&quot;css/custom.css&quot;</span>],</span><br><span class="line">			<span class="comment">// 代码注入的时间，可选值： &quot;document_start&quot;, &quot;document_end&quot;, or &quot;document_idle&quot;，最后一个表示页面空闲时，默认document_idle</span></span><br><span class="line">			<span class="string">&quot;run_at&quot;</span>: <span class="string">&quot;document_start&quot;</span></span><br><span class="line">		&#125;</span><br><span class="line">	],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>特别注意，如果没有主动指定<code>run_at</code>为<code>document_start</code>（默认为<code>document_idle</code>），下面这种代码是不会生效的：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.addEventListener(<span class="string">&#x27;DOMContentLoaded&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">&#x27;我被执行了！&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><code>content-scripts</code>和原始页面共享DOM，但是不共享JS，如要访问页面JS（例如某个JS变量），只能通过<code>injected js</code>来实现。<code>content-scripts</code>不能访问绝大部分<code>chrome.xxx.api</code>，除了下面这4种：</p>
<ul>
<li>chrome.extension(getURL , inIncognitoContext , lastError , onRequest , sendRequest)</li>
<li>chrome.i18n</li>
<li>chrome.runtime(connect , getManifest , getURL , id , onConnect , onMessage , sendMessage)</li>
<li>chrome.storage</li>
</ul>
<p>其实看到这里不要悲观，这些API绝大部分时候都够用了，非要调用其它API的话，你还可以通过通信来实现让background来帮你调用（关于通信，后文有详细介绍）。</p>
<p>好了，Chrome插件给我们提供了这么强大的JS注入功能，剩下的就是发挥你的想象力去玩弄浏览器了。</p>
<h2 id="background"><a href="#background" class="headerlink" title="background"></a>background</h2><p>后台（姑且这么翻译吧），是一个常驻的页面，它的生命周期是插件中所有类型页面中最长的，它随着浏览器的打开而打开，随着浏览器的关闭而关闭，所以通常把需要一直运行的、启动就运行的、全局的代码放在background里面。</p>
<p>background的权限非常高，几乎可以调用所有的Chrome扩展API（除了devtools），而且它可以无限制跨域，也就是可以跨域访问任何网站而无需要求对方设置<code>CORS</code>。</p>
<blockquote>
<p>经过测试，其实不止是background，所有的直接通过<code>chrome-extension://id/xx.html</code>这种方式打开的网页都可以无限制跨域。</p>
</blockquote>
<p>配置中，<code>background</code>可以通过<code>page</code>指定一张网页，也可以通过<code>scripts</code>直接指定一个JS，Chrome会自动为这个JS生成一个默认的网页：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="comment">// 会一直常驻的后台JS或后台页面</span></span><br><span class="line">	<span class="string">&quot;background&quot;</span>:</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">// 2种指定方式，如果指定JS，那么会自动生成一个背景页</span></span><br><span class="line">		<span class="string">&quot;page&quot;</span>: <span class="string">&quot;background.html&quot;</span></span><br><span class="line">		<span class="comment">//&quot;scripts&quot;: [&quot;js/background.js&quot;]</span></span><br><span class="line">	&#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>需要特别说明的是，虽然你可以通过<code>chrome-extension://xxx/background.html</code>直接打开后台页，但是你打开的后台页和真正一直在后台运行的那个页面不是同一个，换句话说，你可以打开无数个<code>background.html</code>，但是真正在后台常驻的只有一个，而且这个你永远看不到它的界面，只能调试它的代码。</p>
<h2 id="event-pages"><a href="#event-pages" class="headerlink" title="event-pages"></a>event-pages</h2><p>这里顺带介绍一下<a target="_blank" rel="noopener" href="https://developer.chrome.com/extensions/event_pages">event-pages</a>，它是一个什么东西呢？鉴于background生命周期太长，长时间挂载后台可能会影响性能，所以Google又弄一个<code>event-pages</code>，在配置文件上，它与background的唯一区别就是多了一个<code>persistent</code>参数：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;background&quot;</span>:</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="string">&quot;scripts&quot;</span>: [<span class="string">&quot;event-page.js&quot;</span>],</span><br><span class="line">		<span class="string">&quot;persistent&quot;</span>: <span class="literal">false</span></span><br><span class="line">	&#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>它的生命周期是：在被需要时加载，在空闲时被关闭，什么叫被需要时呢？比如第一次安装、插件更新、有content-script向它发送消息，等等。</p>
<p>除了配置文件的变化，代码上也有一些细微变化，个人这个简单了解一下就行了，一般情况下background也不会很消耗性能的。</p>
<h2 id="popup"><a href="#popup" class="headerlink" title="popup"></a>popup</h2><p><code>popup</code>是点击<code>browser_action</code>或者<code>page_action</code>图标时打开的一个小窗口网页，焦点离开网页就立即关闭，一般用来做一些临时性的交互。</p>
<p><img src="http://image.liuxianan.com/201706/20170619_161102_335_9254.png" alt="博客园网摘插件popup效果"></p>
<p><code>popup</code>可以包含任意你想要的HTML内容，并且会自适应大小。可以通过<code>default_popup</code>字段来指定popup页面，也可以调用<code>setPopup()</code>方法。</p>
<p>配置方式：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;browser_action&quot;</span>:</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="string">&quot;default_icon&quot;</span>: <span class="string">&quot;img/icon.png&quot;</span>,</span><br><span class="line">		<span class="comment">// 图标悬停时的标题，可选</span></span><br><span class="line">		<span class="string">&quot;default_title&quot;</span>: <span class="string">&quot;这是一个示例Chrome插件&quot;</span>,</span><br><span class="line">		<span class="string">&quot;default_popup&quot;</span>: <span class="string">&quot;popup.html&quot;</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="http://image.liuxianan.com/201705/20170531_172243_007_2793.png"></p>
<p>需要特别注意的是，由于单击图标打开popup，焦点离开又立即关闭，所以popup页面的生命周期一般很短，需要长时间运行的代码千万不要写在popup里面。</p>
<p>在权限上，它和background非常类似，它们之间最大的不同是生命周期的不同，popup中可以直接通过<code>chrome.extension.getBackgroundPage()</code>获取background的window对象。</p>
<h2 id="injected-script"><a href="#injected-script" class="headerlink" title="injected-script"></a>injected-script</h2><p>这里的<code>injected-script</code>是我给它取的，指的是通过DOM操作的方式向页面注入的一种JS。为什么要把这种JS单独拿出来讨论呢？又或者说为什么需要通过这种方式注入JS呢？</p>
<p>这是因为<code>content-script</code>有一个很大的“缺陷”，也就是无法访问页面中的JS，虽然它可以操作DOM，但是DOM却不能调用它，也就是无法在DOM中通过绑定事件的方式调用<code>content-script</code>中的代码（包括直接写<code>onclick</code>和<code>addEventListener</code>2种方式都不行），但是，“在页面上添加一个按钮并调用插件的扩展API”是一个很常见的需求，那该怎么办呢？其实这就是本小节要讲的。</p>
<p>在<code>content-script</code>中通过DOM方式向页面注入<code>inject-script</code>代码示例：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 向页面注入JS</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">injectCustomJs</span>(<span class="params">jsPath</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	jsPath = jsPath || <span class="string">&#x27;js/inject.js&#x27;</span>;</span><br><span class="line">	<span class="keyword">var</span> temp = <span class="built_in">document</span>.createElement(<span class="string">&#x27;script&#x27;</span>);</span><br><span class="line">	temp.setAttribute(<span class="string">&#x27;type&#x27;</span>, <span class="string">&#x27;text/javascript&#x27;</span>);</span><br><span class="line">	<span class="comment">// 获得的地址类似：chrome-extension://ihcokhadfjfchaeagdoclpnjdiokfakg/js/inject.js</span></span><br><span class="line">	temp.src = chrome.extension.getURL(jsPath);</span><br><span class="line">	temp.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="comment">// 放在页面不好看，执行完后移除掉</span></span><br><span class="line">		<span class="built_in">this</span>.parentNode.removeChild(<span class="built_in">this</span>);</span><br><span class="line">	&#125;;</span><br><span class="line">	<span class="built_in">document</span>.head.appendChild(temp);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>你以为这样就行了？执行一下你会看到如下报错：</p>
<pre><code>Denying load of chrome-extension://efbllncjkjiijkppagepehoekjojdclc/js/inject.js. Resources must be listed in the web_accessible_resources manifest key in order to be loaded by pages outside the extension.</code></pre>
<p>意思就是你想要在web中直接访问插件中的资源的话必须显示声明才行，配置文件中增加如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="comment">// 普通页面能够直接访问的插件资源列表，如果不设置是无法直接访问的</span></span><br><span class="line">	<span class="string">&quot;web_accessible_resources&quot;</span>: [<span class="string">&quot;js/inject.js&quot;</span>],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>至于<code>inject-script</code>如何调用<code>content-script</code>中的代码，后面我会在专门的一个消息通信章节详细介绍。</p>
<h2 id="homepage-url"><a href="#homepage-url" class="headerlink" title="homepage_url"></a>homepage_url</h2><p>开发者或者插件主页设置，一般会在如下2个地方显示：</p>
<p><img src="http://image.liuxianan.com/201705/20170531_105821_586_0442.png"></p>
<p><img src="http://image.liuxianan.com/201705/20170531_105907_256_9087.png"></p>
<h1 id="Chrome插件的8种展示形式"><a href="#Chrome插件的8种展示形式" class="headerlink" title="Chrome插件的8种展示形式"></a>Chrome插件的8种展示形式</h1><h2 id="browserAction-浏览器右上角"><a href="#browserAction-浏览器右上角" class="headerlink" title="browserAction(浏览器右上角)"></a>browserAction(浏览器右上角)</h2><p>通过配置<code>browser_action</code>可以在浏览器的右上角增加一个图标，一个<code>browser_action</code>可以拥有一个图标，一个<code>tooltip</code>，一个<code>badge</code>和一个<code>popup</code>。</p>
<p>示例配置如下：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&quot;browser_action&quot;:</span><br><span class="line">&#123;</span><br><span class="line">	<span class="attr">&quot;default_icon&quot;</span>: <span class="string">&quot;img/icon.png&quot;</span>,</span><br><span class="line">	<span class="attr">&quot;default_title&quot;</span>: <span class="string">&quot;这是一个示例Chrome插件&quot;</span>,</span><br><span class="line">	<span class="attr">&quot;default_popup&quot;</span>: <span class="string">&quot;popup.html&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="图标"><a href="#图标" class="headerlink" title="图标"></a>图标</h3><p><code>browser_action</code>图标推荐使用宽高都为19像素的图片，更大的图标会被缩小，格式随意，一般推荐png，可以通过manifest中<code>default_icon</code>字段配置，也可以调用setIcon()方法。</p>
<h3 id="tooltip"><a href="#tooltip" class="headerlink" title="tooltip"></a>tooltip</h3><p>修改<code>browser_action</code>的manifest中<code>default_title</code>字段，或者调用<code>setTitle()</code>方法。</p>
<p><img src="http://image.liuxianan.com/201705/20170531_170829_477_1329.png"></p>
<h3 id="badge"><a href="#badge" class="headerlink" title="badge"></a>badge</h3><p>所谓<code>badge</code>就是在图标上显示一些文本，可以用来更新一些小的扩展状态提示信息。因为badge空间有限，所以只支持4个以下的字符（英文4个，中文2个）。badge无法通过配置文件来指定，必须通过代码实现，设置badge文字和颜色可以分别使用<code>setBadgeText()</code>和<code>setBadgeBackgroundColor()</code>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chrome.browserAction.setBadgeText(&#123;<span class="attr">text</span>: <span class="string">&#x27;new&#x27;</span>&#125;);</span><br><span class="line">chrome.browserAction.setBadgeBackgroundColor(&#123;<span class="attr">color</span>: [<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>]&#125;);</span><br></pre></td></tr></table></figure>

<p>效果：</p>
<p><img src="http://image.liuxianan.com/201705/20170531_171447_912_1165.png"></p>
<h2 id="pageAction-地址栏右侧"><a href="#pageAction-地址栏右侧" class="headerlink" title="pageAction(地址栏右侧)"></a>pageAction(地址栏右侧)</h2><p>所谓<code>pageAction</code>，指的是只有当某些特定页面打开才显示的图标，它和<code>browserAction</code>最大的区别是一个始终都显示，一个只在特定情况才显示。</p>
<p>需要特别说明的是早些版本的Chrome是将pageAction放在地址栏的最右边，左键单击弹出popup，右键单击则弹出相关默认的选项菜单：</p>
<p><img src="http://image.liuxianan.com/201705/20170531_103311_849_4399.png"></p>
<p>而新版的Chrome更改了这一策略，pageAction和普通的browserAction一样也是放在浏览器右上角，只不过没有点亮时是灰色的，点亮了才是彩色的，灰色时无论左键还是右键单击都是弹出选项：</p>
<p><img src="http://image.liuxianan.com/201705/20170531_104038_208_9352.gif"></p>
<blockquote>
<p>具体是从哪一版本开始改的没去仔细考究，反正知道v50.0的时候还是前者，v58.0的时候已改为后者。</p>
</blockquote>
<p>调整之后的<code>pageAction</code>我们可以简单地把它看成是可以置灰的<code>browserAction</code>。</p>
<ul>
<li>chrome.pageAction.show(tabId) 显示图标；</li>
<li>chrome.pageAction.hide(tabId) 隐藏图标；</li>
</ul>
<p>示例(只有打开百度才显示图标)：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// manifest.json</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;page_action&quot;</span>:</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="string">&quot;default_icon&quot;</span>: <span class="string">&quot;img/icon.png&quot;</span>,</span><br><span class="line">		<span class="string">&quot;default_title&quot;</span>: <span class="string">&quot;我是pageAction&quot;</span>,</span><br><span class="line">		<span class="string">&quot;default_popup&quot;</span>: <span class="string">&quot;popup.html&quot;</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="string">&quot;permissions&quot;</span>: [<span class="string">&quot;declarativeContent&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// background.js</span></span><br><span class="line">chrome.runtime.onInstalled.addListener(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	chrome.declarativeContent.onPageChanged.removeRules(<span class="literal">undefined</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		chrome.declarativeContent.onPageChanged.addRules([</span><br><span class="line">			&#123;</span><br><span class="line">				conditions: [</span><br><span class="line">					<span class="comment">// 只有打开百度才显示pageAction</span></span><br><span class="line">					<span class="keyword">new</span> chrome.declarativeContent.PageStateMatcher(&#123;<span class="attr">pageUrl</span>: &#123;<span class="attr">urlContains</span>: <span class="string">&#x27;baidu.com&#x27;</span>&#125;&#125;)</span><br><span class="line">				],</span><br><span class="line">				actions: [<span class="keyword">new</span> chrome.declarativeContent.ShowPageAction()]</span><br><span class="line">			&#125;</span><br><span class="line">		]);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>效果图：</p>
<p><img src="http://image.liuxianan.com/201705/20170531_174018_541_0451.gif"></p>
<h2 id="右键菜单"><a href="#右键菜单" class="headerlink" title="右键菜单"></a>右键菜单</h2><p>通过开发Chrome插件可以自定义浏览器的右键菜单，主要是通过<code>chrome.contextMenus</code>API实现，右键菜单可以出现在不同的上下文，比如普通页面、选中的文字、图片、链接，等等，如果有同一个插件里面定义了多个菜单，Chrome会自动组合放到以插件名字命名的二级菜单里，如下：</p>
<p><img src="http://image.liuxianan.com/201705/20170531_151134_967_0243.png"></p>
<h3 id="最简单的右键菜单示例"><a href="#最简单的右键菜单示例" class="headerlink" title="最简单的右键菜单示例"></a>最简单的右键菜单示例</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// manifest.json</span></span><br><span class="line">&#123;<span class="string">&quot;permissions&quot;</span>: [<span class="string">&quot;contextMenus&quot;</span>]&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// background.js</span></span><br><span class="line">chrome.contextMenus.create(&#123;</span><br><span class="line">	title: <span class="string">&quot;测试右键菜单&quot;</span>,</span><br><span class="line">	onclick: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;alert(<span class="string">&#x27;您点击了右键菜单！&#x27;</span>);&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>效果：</p>
<p><img src="http://image.liuxianan.com/201705/20170531_145957_183_0527.png"></p>
<h3 id="添加右键百度搜索"><a href="#添加右键百度搜索" class="headerlink" title="添加右键百度搜索"></a>添加右键百度搜索</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// manifest.json</span></span><br><span class="line">&#123;<span class="string">&quot;permissions&quot;</span>: [<span class="string">&quot;contextMenus&quot;</span>， <span class="string">&quot;tabs&quot;</span>]&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// background.js</span></span><br><span class="line">chrome.contextMenus.create(&#123;</span><br><span class="line">	title: <span class="string">&#x27;使用度娘搜索：%s&#x27;</span>, <span class="comment">// %s表示选中的文字</span></span><br><span class="line">	contexts: [<span class="string">&#x27;selection&#x27;</span>], <span class="comment">// 只有当选中文字时才会出现此右键菜单</span></span><br><span class="line">	onclick: <span class="function"><span class="keyword">function</span>(<span class="params">params</span>)</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="comment">// 注意不能使用location.href，因为location是属于background的window对象</span></span><br><span class="line">		chrome.tabs.create(&#123;<span class="attr">url</span>: <span class="string">&#x27;https://www.baidu.com/s?ie=utf-8&amp;wd=&#x27;</span> + <span class="built_in">encodeURI</span>(params.selectionText)&#125;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>效果如下：</p>
<p><img src="http://image.liuxianan.com/201705/20170531_160358_202_7248.png"></p>
<h3 id="语法说明"><a href="#语法说明" class="headerlink" title="语法说明"></a>语法说明</h3><p>这里只是简单列举一些常用的，完整API参见：<a target="_blank" rel="noopener" href="https://developer.chrome.com/extensions/contextMenus">https://developer.chrome.com/extensions/contextMenus</a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">chrome.contextMenus.create(&#123;</span><br><span class="line">	type: <span class="string">&#x27;normal&#x27;</span>， <span class="comment">// 类型，可选：[&quot;normal&quot;, &quot;checkbox&quot;, &quot;radio&quot;, &quot;separator&quot;]，默认 normal</span></span><br><span class="line">	title: <span class="string">&#x27;菜单的名字&#x27;</span>, <span class="comment">// 显示的文字，除非为“separator”类型否则此参数必需，如果类型为“selection”，可以使用%s显示选定的文本</span></span><br><span class="line">	contexts: [<span class="string">&#x27;page&#x27;</span>], <span class="comment">// 上下文环境，可选：[&quot;all&quot;, &quot;page&quot;, &quot;frame&quot;, &quot;selection&quot;, &quot;link&quot;, &quot;editable&quot;, &quot;image&quot;, &quot;video&quot;, &quot;audio&quot;]，默认page</span></span><br><span class="line">	onclick: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;, <span class="comment">// 单击时触发的方法</span></span><br><span class="line">	parentId: <span class="number">1</span>, <span class="comment">// 右键菜单项的父菜单项ID。指定父菜单项将会使此菜单项成为父菜单项的子菜单</span></span><br><span class="line">	documentUrlPatterns: <span class="string">&#x27;https://*.baidu.com/*&#x27;</span> <span class="comment">// 只在某些页面显示此右键菜单</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 删除某一个菜单项</span></span><br><span class="line">chrome.contextMenus.remove(menuItemId)；</span><br><span class="line"><span class="comment">// 删除所有自定义右键菜单</span></span><br><span class="line">chrome.contextMenus.removeAll();</span><br><span class="line"><span class="comment">// 更新某一个菜单项</span></span><br><span class="line">chrome.contextMenus.update(menuItemId, updateProperties);</span><br></pre></td></tr></table></figure>

<h2 id="override-覆盖特定页面"><a href="#override-覆盖特定页面" class="headerlink" title="override(覆盖特定页面)"></a>override(覆盖特定页面)</h2><p>使用<code>override</code>页可以将Chrome默认的一些特定页面替换掉，改为使用扩展提供的页面。</p>
<p>扩展可以替代如下页面：</p>
<ul>
<li>历史记录：从工具菜单上点击历史记录时访问的页面，或者从地址栏直接输入 <a href="chrome://history">chrome://history</a></li>
<li>新标签页：当创建新标签的时候访问的页面，或者从地址栏直接输入 <a href="chrome://newtab">chrome://newtab</a></li>
<li>书签：浏览器的书签，或者直接输入 <a href="chrome://bookmarks">chrome://bookmarks</a></li>
</ul>
<p>注意：</p>
<ul>
<li>一个扩展只能替代一个页面；</li>
<li>不能替代隐身窗口的新标签页；</li>
<li>网页必须设置title，否则用户可能会看到网页的URL，造成困扰；</li>
</ul>
<p>下面的截图是默认的新标签页和被扩展替换掉的新标签页。</p>
<p><img src="http://image.liuxianan.com/201705/20170531_180326_487_3396.png"></p>
<p>代码（注意，一个插件只能替代一个默认页，以下仅为演示）：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;chrome_url_overrides&quot;</span>:</span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;newtab&quot;</span>: <span class="string">&quot;newtab.html&quot;</span>,</span><br><span class="line">	<span class="string">&quot;history&quot;</span>: <span class="string">&quot;history.html&quot;</span>,</span><br><span class="line">	<span class="string">&quot;bookmarks&quot;</span>: <span class="string">&quot;bookmarks.html&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="devtools-开发者工具"><a href="#devtools-开发者工具" class="headerlink" title="devtools(开发者工具)"></a>devtools(开发者工具)</h2><h3 id="预热"><a href="#预热" class="headerlink" title="预热"></a>预热</h3><p>使用过vue的应该见过这种类型的插件：</p>
<p><img src="http://image.liuxianan.com/201706/20170605_181456_375_7033.png"></p>
<p>是的，Chrome允许插件在开发者工具(devtools)上动手脚，主要表现在：</p>
<ul>
<li>自定义一个和多个和<code>Elements</code>、<code>Console</code>、<code>Sources</code>等同级别的面板；</li>
<li>自定义侧边栏(sidebar)，目前只能自定义<code>Elements</code>面板的侧边栏；</li>
</ul>
<p>先来看2张简单的demo截图，自定义面板（判断当前页面是否使用了jQuery）：</p>
<p><img src="http://image.liuxianan.com/201706/20170613_220126_669_2411.png"></p>
<p>自定义侧边栏（获取当前页面所有图片）：</p>
<p><img src="http://image.liuxianan.com/201706/20170605_175952_228_8829.png"></p>
<h3 id="devtools扩展介绍"><a href="#devtools扩展介绍" class="headerlink" title="devtools扩展介绍"></a>devtools扩展介绍</h3><p>主页：<a target="_blank" rel="noopener" href="https://developer.chrome.com/extensions/devtools">https://developer.chrome.com/extensions/devtools</a></p>
<p>来一张官方图片：</p>
<p><img src="http://image.liuxianan.com/201706/20170606_170623_349_6923.png"></p>
<p>每打开一个开发者工具窗口，都会创建devtools页面的实例，F12窗口关闭，页面也随着关闭，所以devtools页面的生命周期和devtools窗口是一致的。devtools页面可以访问一组特有的<code>DevTools API</code>以及有限的扩展API，这组特有的<code>DevTools API</code>只有devtools页面才可以访问，background都无权访问，这些API包括：</p>
<ul>
<li><code>chrome.devtools.panels</code>：面板相关；</li>
<li><code>chrome.devtools.inspectedWindow</code>：获取被审查窗口的有关信息；</li>
<li><code>chrome.devtools.network</code>：获取有关网络请求的信息；</li>
</ul>
<p>大部分扩展API都无法直接被<code>DevTools</code>页面调用，但它可以像<code>content-script</code>一样直接调用<code>chrome.extension</code>和<code>chrome.runtime</code>API，同时它也可以像<code>content-script</code>一样使用Message交互的方式与background页面进行通信。</p>
<h3 id="实例：创建一个devtools扩展"><a href="#实例：创建一个devtools扩展" class="headerlink" title="实例：创建一个devtools扩展"></a>实例：创建一个devtools扩展</h3><p>首先，要针对开发者工具开发插件，需要在清单文件声明如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="comment">// 只能指向一个HTML文件，不能是JS文件</span></span><br><span class="line">	<span class="string">&quot;devtools_page&quot;</span>: <span class="string">&quot;devtools.html&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个<code>devtools.html</code>里面一般什么都没有，就引入一个js：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;js/devtools.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>可以看出来，其实真正代码是<code>devtools.js</code>，html文件是“多余”的，所以这里觉得有点坑，<code>devtools_page</code>干嘛不允许直接指定JS呢？</p>
<p>再来看devtools.js的代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建自定义面板，同一个插件可以创建多个自定义面板</span></span><br><span class="line"><span class="comment">// 几个参数依次为：panel标题、图标（其实设置了也没地方显示）、要加载的页面、加载成功后的回调</span></span><br><span class="line">chrome.devtools.panels.create(<span class="string">&#x27;MyPanel&#x27;</span>, <span class="string">&#x27;img/icon.png&#x27;</span>, <span class="string">&#x27;mypanel.html&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">panel</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">&#x27;自定义面板创建成功！&#x27;</span>); <span class="comment">// 注意这个log一般看不到</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建自定义侧边栏</span></span><br><span class="line">chrome.devtools.panels.elements.createSidebarPane(<span class="string">&quot;Images&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">sidebar</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// sidebar.setPage(&#x27;../sidebar.html&#x27;); // 指定加载某个页面</span></span><br><span class="line">	sidebar.setExpression(<span class="string">&#x27;document.querySelectorAll(&quot;img&quot;)&#x27;</span>, <span class="string">&#x27;All Images&#x27;</span>); <span class="comment">// 通过表达式来指定</span></span><br><span class="line">	<span class="comment">//sidebar.setObject(&#123;aaa: 111, bbb: &#x27;Hello World!&#x27;&#125;); // 直接设置显示某个对象</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>setPage时的效果：</p>
<p><img src="http://image.liuxianan.com/201706/20170613_194023_184_1728.png"></p>
<p>以下截图示例的代码：</p>
<p><img src="http://image.liuxianan.com/201706/20170613_220345_133_1766.png"></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 检测jQuery</span></span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">&#x27;check_jquery&#x27;</span>).addEventListener(<span class="string">&#x27;click&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// 访问被检查的页面DOM需要使用inspectedWindow</span></span><br><span class="line">	<span class="comment">// 简单例子：检测被检查页面是否使用了jQuery</span></span><br><span class="line">	chrome.devtools.inspectedWindow.eval(<span class="string">&quot;jQuery.fn.jquery&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">result, isException</span>)</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">var</span> html = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">		<span class="keyword">if</span> (isException) html = <span class="string">&#x27;当前页面没有使用jQuery。&#x27;</span>;</span><br><span class="line">		<span class="keyword">else</span> html = <span class="string">&#x27;当前页面使用了jQuery，版本为：&#x27;</span>+result;</span><br><span class="line">		alert(html);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 打开某个资源</span></span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">&#x27;open_resource&#x27;</span>).addEventListener(<span class="string">&#x27;click&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	chrome.devtools.inspectedWindow.eval(<span class="string">&quot;window.location.href&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">result, isException</span>)</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		chrome.devtools.panels.openResource(result, <span class="number">20</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">		</span>&#123;</span><br><span class="line">			<span class="built_in">console</span>.log(<span class="string">&#x27;资源打开成功！&#x27;</span>);</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 审查元素</span></span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">&#x27;test_inspect&#x27;</span>).addEventListener(<span class="string">&#x27;click&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	chrome.devtools.inspectedWindow.eval(<span class="string">&quot;inspect(document.images[0])&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">result, isException</span>)</span>&#123;&#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取所有资源</span></span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">&#x27;get_all_resources&#x27;</span>).addEventListener(<span class="string">&#x27;click&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	chrome.devtools.inspectedWindow.getResources(<span class="function"><span class="keyword">function</span>(<span class="params">resources</span>)</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		alert(<span class="built_in">JSON</span>.stringify(resources));</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="调试技巧"><a href="#调试技巧" class="headerlink" title="调试技巧"></a>调试技巧</h3><p>修改了devtools页面的代码时，需要先在 chrome://extensions 页面按下<code>Ctrl+R</code>重新加载插件，然后关闭再打开开发者工具即可，无需刷新页面（而且只刷新页面不刷新开发者工具的话是不会生效的）。</p>
<p>由于devtools本身就是开发者工具页面，所以几乎没有方法可以直接调试它，直接用 <code>chrome-extension://extid/devtools.html&quot;</code>的方式打开页面肯定报错，因为不支持相关特殊API，只能先自己写一些方法屏蔽这些错误，调试通了再放开。</p>
<h2 id="option-选项页"><a href="#option-选项页" class="headerlink" title="option(选项页)"></a>option(选项页)</h2><p>所谓<code>options</code>页，就是插件的设置页面，有2个入口，一个是右键图标有一个“选项”菜单，还有一个在插件管理页面：</p>
<p><img src="http://image.liuxianan.com/201706/20170621_170046_846_5529.png"></p>
<p><img src="http://image.liuxianan.com/201706/20170621_115902_196_9130.png"></p>
<p>在Chrome40以前，options页面和其它普通页面没什么区别，Chrome40以后则有了一些变化。</p>
<p>我们先看老版的<a target="_blank" rel="noopener" href="https://developer.chrome.com/extensions/options">options</a>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="comment">// Chrome40以前的插件配置页写法</span></span><br><span class="line">	<span class="string">&quot;options_page&quot;</span>: <span class="string">&quot;options.html&quot;</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个页面里面的内容就随你自己发挥了，配置之后在插件管理页就会看到一个<code>选项</code>按钮入口，点进去就是打开一个网页，没啥好讲的。</p>
<p>效果:</p>
<p><img src="http://image.liuxianan.com/201706/20170621_115705_433_5886.png"></p>
<p>再来看新版的<a target="_blank" rel="noopener" href="https://developer.chrome.com/extensions/optionsV2">optionsV2</a>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;options_ui&quot;</span>:</span><br><span class="line">	&#123;</span><br><span class="line">    	<span class="string">&quot;page&quot;</span>: <span class="string">&quot;options.html&quot;</span>,</span><br><span class="line">		<span class="comment">// 添加一些默认的样式，推荐使用</span></span><br><span class="line">    	<span class="string">&quot;chrome_style&quot;</span>: <span class="literal">true</span></span><br><span class="line">	&#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>options.html</code>的代码我们没有任何改动，只是配置文件改了，之后效果如下：</p>
<p><img src="http://image.liuxianan.com/201706/20170621_115809_750_1163.png"></p>
<p>看起来是不是高大上了？</p>
<p>几点注意：</p>
<ul>
<li>为了兼容，建议2种都写，如果都写了，Chrome40以后会默认读取新版的方式；</li>
<li>新版options中不能使用alert；</li>
<li>数据存储建议用chrome.storage，因为会随用户自动同步；</li>
</ul>
<h2 id="omnibox"><a href="#omnibox" class="headerlink" title="omnibox"></a>omnibox</h2><p><code>omnibox</code>是向用户提供搜索建议的一种方式。先来看个<code>gif</code>图以便了解一下这东西到底是个什么鬼：</p>
<p><img src="http://image.liuxianan.com/201706/20170621_155455_980_5359.gif"></p>
<p>注册某个关键字以触发插件自己的搜索建议界面，然后可以任意发挥了。</p>
<p>首先，配置文件如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="comment">// 向地址栏注册一个关键字以提供搜索建议，只能设置一个关键字</span></span><br><span class="line">	<span class="string">&quot;omnibox&quot;</span>: &#123; <span class="string">&quot;keyword&quot;</span> : <span class="string">&quot;go&quot;</span> &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后<code>background.js</code>中注册监听事件：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// omnibox 演示</span></span><br><span class="line">chrome.omnibox.onInputChanged.addListener(<span class="function">(<span class="params">text, suggest</span>) =&gt;</span> &#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">&#x27;inputChanged: &#x27;</span> + text);</span><br><span class="line">	<span class="keyword">if</span>(!text) <span class="keyword">return</span>;</span><br><span class="line">	<span class="keyword">if</span>(text == <span class="string">&#x27;美女&#x27;</span>) &#123;</span><br><span class="line">		suggest([</span><br><span class="line">			&#123;<span class="attr">content</span>: <span class="string">&#x27;中国&#x27;</span> + text, <span class="attr">description</span>: <span class="string">&#x27;你要找“中国美女”吗？&#x27;</span>&#125;,</span><br><span class="line">			&#123;<span class="attr">content</span>: <span class="string">&#x27;日本&#x27;</span> + text, <span class="attr">description</span>: <span class="string">&#x27;你要找“日本美女”吗？&#x27;</span>&#125;,</span><br><span class="line">			&#123;<span class="attr">content</span>: <span class="string">&#x27;泰国&#x27;</span> + text, <span class="attr">description</span>: <span class="string">&#x27;你要找“泰国美女或人妖”吗？&#x27;</span>&#125;,</span><br><span class="line">			&#123;<span class="attr">content</span>: <span class="string">&#x27;韩国&#x27;</span> + text, <span class="attr">description</span>: <span class="string">&#x27;你要找“韩国美女”吗？&#x27;</span>&#125;</span><br><span class="line">		]);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span>(text == <span class="string">&#x27;微博&#x27;</span>) &#123;</span><br><span class="line">		suggest([</span><br><span class="line">			&#123;<span class="attr">content</span>: <span class="string">&#x27;新浪&#x27;</span> + text, <span class="attr">description</span>: <span class="string">&#x27;新浪&#x27;</span> + text&#125;,</span><br><span class="line">			&#123;<span class="attr">content</span>: <span class="string">&#x27;腾讯&#x27;</span> + text, <span class="attr">description</span>: <span class="string">&#x27;腾讯&#x27;</span> + text&#125;,</span><br><span class="line">			&#123;<span class="attr">content</span>: <span class="string">&#x27;搜狐&#x27;</span> + text, <span class="attr">description</span>: <span class="string">&#x27;搜索&#x27;</span> + text&#125;,</span><br><span class="line">		]);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123;</span><br><span class="line">		suggest([</span><br><span class="line">			&#123;<span class="attr">content</span>: <span class="string">&#x27;百度搜索 &#x27;</span> + text, <span class="attr">description</span>: <span class="string">&#x27;百度搜索 &#x27;</span> + text&#125;,</span><br><span class="line">			&#123;<span class="attr">content</span>: <span class="string">&#x27;谷歌搜索 &#x27;</span> + text, <span class="attr">description</span>: <span class="string">&#x27;谷歌搜索 &#x27;</span> + text&#125;,</span><br><span class="line">		]);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 当用户接收关键字建议时触发</span></span><br><span class="line">chrome.omnibox.onInputEntered.addListener(<span class="function">(<span class="params">text</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;inputEntered: &#x27;</span> + text);</span><br><span class="line">	<span class="keyword">if</span>(!text) <span class="keyword">return</span>;</span><br><span class="line">	<span class="keyword">var</span> href = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span>(text.endsWith(<span class="string">&#x27;美女&#x27;</span>)) href = <span class="string">&#x27;http://image.baidu.com/search/index?tn=baiduimage&amp;ie=utf-8&amp;word=&#x27;</span> + text;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span>(text.startsWith(<span class="string">&#x27;百度搜索&#x27;</span>)) href = <span class="string">&#x27;https://www.baidu.com/s?ie=UTF-8&amp;wd=&#x27;</span> + text.replace(<span class="string">&#x27;百度搜索 &#x27;</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span>(text.startsWith(<span class="string">&#x27;谷歌搜索&#x27;</span>)) href = <span class="string">&#x27;https://www.google.com.tw/search?q=&#x27;</span> + text.replace(<span class="string">&#x27;谷歌搜索 &#x27;</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">	<span class="keyword">else</span> href = <span class="string">&#x27;https://www.baidu.com/s?ie=UTF-8&amp;wd=&#x27;</span> + text;</span><br><span class="line">	openUrlCurrentTab(href);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 获取当前选项卡ID</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getCurrentTabId</span>(<span class="params">callback</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	chrome.tabs.query(&#123;<span class="attr">active</span>: <span class="literal">true</span>, <span class="attr">currentWindow</span>: <span class="literal">true</span>&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">tabs</span>)</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(callback) callback(tabs.length ? tabs[<span class="number">0</span>].id: <span class="literal">null</span>);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 当前标签打开某个链接</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">openUrlCurrentTab</span>(<span class="params">url</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	getCurrentTabId(<span class="function"><span class="params">tabId</span> =&gt;</span> &#123;</span><br><span class="line">		chrome.tabs.update(tabId, &#123;<span class="attr">url</span>: url&#125;);</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="桌面通知"><a href="#桌面通知" class="headerlink" title="桌面通知"></a>桌面通知</h2><p>Chrome提供了一个<code>chrome.notifications</code>API以便插件推送桌面通知，暂未找到<code>chrome.notifications</code>和HTML5自带的<code>Notification</code>的显著区别及优势。</p>
<p>在后台JS中，无论是使用<code>chrome.notifications</code>还是<code>Notification</code>都不需要申请权限（HTML5方式需要申请权限），直接使用即可。</p>
<p>最简单的通知：</p>
<p><img src="http://image.liuxianan.com/201705/20170531_193633_369_0274.png"></p>
<p>代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">chrome.notifications.create(<span class="literal">null</span>, &#123;</span><br><span class="line">	type: <span class="string">&#x27;basic&#x27;</span>,</span><br><span class="line">	iconUrl: <span class="string">&#x27;img/icon.png&#x27;</span>,</span><br><span class="line">	title: <span class="string">&#x27;这是标题&#x27;</span>,</span><br><span class="line">	message: <span class="string">&#x27;您刚才点击了自定义右键菜单！&#x27;</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>通知的样式可以很丰富：</p>
<p><img src="http://image.liuxianan.com/201705/20170531_193836_583_4450.png"></p>
<p>这个没有深入研究，有需要的可以去看官方文档。</p>
<h1 id="5种类型的JS对比"><a href="#5种类型的JS对比" class="headerlink" title="5种类型的JS对比"></a>5种类型的JS对比</h1><p>Chrome插件的JS主要可以分为这5类：<code>injected script</code>、<code>content-script</code>、<code>popup js</code>、<code>background js</code>和<code>devtools js</code>，</p>
<h2 id="权限对比"><a href="#权限对比" class="headerlink" title="权限对比"></a>权限对比</h2><table>
<thead>
<tr>
<th>JS种类</th>
<th>可访问的API</th>
<th>DOM访问情况</th>
<th>JS访问情况</th>
<th>直接跨域</th>
</tr>
</thead>
<tbody><tr>
<td>injected script</td>
<td>和普通JS无任何差别，不能访问任何扩展API</td>
<td>可以访问</td>
<td>可以访问</td>
<td>不可以</td>
</tr>
<tr>
<td>content script</td>
<td>只能访问 extension、runtime等部分API</td>
<td>可以访问</td>
<td>不可以</td>
<td>不可以</td>
</tr>
<tr>
<td>popup js</td>
<td>可访问绝大部分API，除了devtools系列</td>
<td>不可直接访问</td>
<td>不可以</td>
<td>可以</td>
</tr>
<tr>
<td>background js</td>
<td>可访问绝大部分API，除了devtools系列</td>
<td>不可直接访问</td>
<td>不可以</td>
<td>可以</td>
</tr>
<tr>
<td>devtools js</td>
<td>只能访问 devtools、extension、runtime等部分API</td>
<td>可以</td>
<td>可以</td>
<td>不可以</td>
</tr>
</tbody></table>
<h2 id="调试方式对比"><a href="#调试方式对比" class="headerlink" title="调试方式对比"></a>调试方式对比</h2><table>
<thead>
<tr>
<th>JS类型</th>
<th>调试方式</th>
<th>图片说明</th>
</tr>
</thead>
<tbody><tr>
<td>injected script</td>
<td>直接普通的F12即可</td>
<td>懒得截图</td>
</tr>
<tr>
<td>content-script</td>
<td>打开Console,如图切换</td>
<td><img src="http://image.liuxianan.com/201612/20161220_105526_629_8533.png"></td>
</tr>
<tr>
<td>popup-js</td>
<td>popup页面右键审查元素</td>
<td><img src="http://image.liuxianan.com/201612/20161220_105716_178_6900.png"></td>
</tr>
<tr>
<td>background</td>
<td>插件管理页点击背景页即可</td>
<td><img src="http://image.liuxianan.com/201612/20161220_105811_922_5621.png"></td>
</tr>
<tr>
<td>devtools-js</td>
<td>暂未找到有效方法</td>
<td>-</td>
</tr>
</tbody></table>
<h1 id="消息通信"><a href="#消息通信" class="headerlink" title="消息通信"></a>消息通信</h1><p>通信主页：<a target="_blank" rel="noopener" href="https://developer.chrome.com/extensions/messaging">https://developer.chrome.com/extensions/messaging</a></p>
<p>前面我们介绍了Chrome插件中存在的5种JS，那么它们之间如何互相通信呢？下面先来系统概况一下，然后再分类细说。需要知道的是，popup和background其实几乎可以视为一种东西，因为它们可访问的API都一样、通信机制一样、都可以跨域。</p>
<h2 id="互相通信概览"><a href="#互相通信概览" class="headerlink" title="互相通信概览"></a>互相通信概览</h2><p>注：<code>-</code>表示不存在或者无意义，或者待验证。</p>
<table>
<thead>
<tr>
<th></th>
<th>injected-script</th>
<th>content-script</th>
<th>popup-js</th>
<th>background-js</th>
</tr>
</thead>
<tbody><tr>
<td>injected-script</td>
<td>-</td>
<td>window.postMessage</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>content-script</td>
<td>window.postMessage</td>
<td>-</td>
<td>chrome.runtime.sendMessage chrome.runtime.connect</td>
<td>chrome.runtime.sendMessage chrome.runtime.connect</td>
</tr>
<tr>
<td>popup-js</td>
<td>-</td>
<td>chrome.tabs.sendMessage chrome.tabs.connect</td>
<td>-</td>
<td>chrome.extension. getBackgroundPage()</td>
</tr>
<tr>
<td>background-js</td>
<td>-</td>
<td>chrome.tabs.sendMessage chrome.tabs.connect</td>
<td>chrome.extension.getViews</td>
<td>-</td>
</tr>
<tr>
<td>devtools-js</td>
<td>chrome.devtools. inspectedWindow.eval</td>
<td>-</td>
<td>chrome.runtime.sendMessage</td>
<td>chrome.runtime.sendMessage</td>
</tr>
</tbody></table>
<h2 id="通信详细介绍"><a href="#通信详细介绍" class="headerlink" title="通信详细介绍"></a>通信详细介绍</h2><h3 id="popup和background"><a href="#popup和background" class="headerlink" title="popup和background"></a>popup和background</h3><p>popup可以直接调用background中的JS方法，也可以直接访问background的DOM：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// background.js</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	alert(<span class="string">&#x27;我是background！&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// popup.js</span></span><br><span class="line"><span class="keyword">var</span> bg = chrome.extension.getBackgroundPage();</span><br><span class="line">bg.test(); <span class="comment">// 访问bg的函数</span></span><br><span class="line">alert(bg.document.body.innerHTML); <span class="comment">// 访问bg的DOM</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>小插曲，今天碰到一个情况，发现popup无法获取background的任何方法，找了半天才发现是因为background的js报错了，而你如果不主动查看background的js的话，是看不到错误信息的，特此提醒。</p>
</blockquote>
<p>至于<code>background</code>访问<code>popup</code>如下（前提是<code>popup</code>已经打开）：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> views = chrome.extension.getViews(&#123;<span class="attr">type</span>:<span class="string">&#x27;popup&#x27;</span>&#125;);</span><br><span class="line"><span class="keyword">if</span>(views.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">	<span class="built_in">console</span>.log(views[<span class="number">0</span>].location.href);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="popup或者bg向content主动发送消息"><a href="#popup或者bg向content主动发送消息" class="headerlink" title="popup或者bg向content主动发送消息"></a>popup或者bg向content主动发送消息</h3><p>background.js或者popup.js：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sendMessageToContentScript</span>(<span class="params">message, callback</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	chrome.tabs.query(&#123;<span class="attr">active</span>: <span class="literal">true</span>, <span class="attr">currentWindow</span>: <span class="literal">true</span>&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">tabs</span>)</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		chrome.tabs.sendMessage(tabs[<span class="number">0</span>].id, message, <span class="function"><span class="keyword">function</span>(<span class="params">response</span>)</span></span><br><span class="line"><span class="function">		</span>&#123;</span><br><span class="line">			<span class="keyword">if</span>(callback) callback(response);</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br><span class="line">sendMessageToContentScript(&#123;<span class="attr">cmd</span>:<span class="string">&#x27;test&#x27;</span>, <span class="attr">value</span>:<span class="string">&#x27;你好，我是popup！&#x27;</span>&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">response</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">&#x27;来自content的回复：&#x27;</span>+response);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><code>content-script.js</code>接收：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">chrome.runtime.onMessage.addListener(<span class="function"><span class="keyword">function</span>(<span class="params">request, sender, sendResponse</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// console.log(sender.tab ?&quot;from a content script:&quot; + sender.tab.url :&quot;from the extension&quot;);</span></span><br><span class="line">	<span class="keyword">if</span>(request.cmd == <span class="string">&#x27;test&#x27;</span>) alert(request.value);</span><br><span class="line">	sendResponse(<span class="string">&#x27;我收到了你的消息！&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>双方通信直接发送的都是JSON对象，不是JSON字符串，所以无需解析，很方便（当然也可以直接发送字符串）。</p>
<blockquote>
<p>网上有些老代码中用的是<code>chrome.extension.onMessage</code>，没有完全查清二者的区别(貌似是别名)，但是建议统一使用<code>chrome.runtime.onMessage</code>。</p>
</blockquote>
<h3 id="content-script主动发消息给后台"><a href="#content-script主动发消息给后台" class="headerlink" title="content-script主动发消息给后台"></a>content-script主动发消息给后台</h3><p>content-script.js：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">chrome.runtime.sendMessage(&#123;<span class="attr">greeting</span>: <span class="string">&#x27;你好，我是content-script呀，我主动发消息给后台！&#x27;</span>&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">response</span>) </span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">&#x27;收到来自后台的回复：&#x27;</span> + response);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>background.js 或者 popup.js：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 监听来自content-script的消息</span></span><br><span class="line">chrome.runtime.onMessage.addListener(<span class="function"><span class="keyword">function</span>(<span class="params">request, sender, sendResponse</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">&#x27;收到来自content-script的消息：&#x27;</span>);</span><br><span class="line">	<span class="built_in">console</span>.log(request, sender, sendResponse);</span><br><span class="line">	sendResponse(<span class="string">&#x27;我是后台，我已收到你的消息：&#x27;</span> + <span class="built_in">JSON</span>.stringify(request));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>注意事项：</p>
<ul>
<li>content_scripts向<code>popup</code>主动发消息的前提是popup必须打开！否则需要利用background作中转；</li>
<li>如果background和popup同时监听，那么它们都可以同时收到消息，但是只有一个可以sendResponse，一个先发送了，那么另外一个再发送就无效；</li>
</ul>
<h3 id="injected-script和content-script"><a href="#injected-script和content-script" class="headerlink" title="injected script和content-script"></a>injected script和content-script</h3><p><code>content-script</code>和页面内的脚本（<code>injected-script</code>自然也属于页面内的脚本）之间唯一共享的东西就是页面的DOM元素，有2种方法可以实现二者通讯：</p>
<ol>
<li>可以通过<code>window.postMessage</code>和<code>window.addEventListener</code>来实现二者消息通讯；</li>
<li>通过自定义DOM事件来实现；</li>
</ol>
<p>第一种方法（推荐）：</p>
<p><code>injected-script</code>中：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.postMessage(&#123;<span class="string">&quot;test&quot;</span>: <span class="string">&#x27;你好！&#x27;</span>&#125;, <span class="string">&#x27;*&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>content script中：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.addEventListener(<span class="string">&quot;message&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(e.data);</span><br><span class="line">&#125;, <span class="literal">false</span>);</span><br></pre></td></tr></table></figure>

<p>第二种方法：</p>
<p><code>injected-script</code>中：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> customEvent = <span class="built_in">document</span>.createEvent(<span class="string">&#x27;Event&#x27;</span>);</span><br><span class="line">customEvent.initEvent(<span class="string">&#x27;myCustomEvent&#x27;</span>, <span class="literal">true</span>, <span class="literal">true</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fireCustomEvent</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">	hiddenDiv = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;myCustomEventDiv&#x27;</span>);</span><br><span class="line">	hiddenDiv.innerText = data</span><br><span class="line">	hiddenDiv.dispatchEvent(customEvent);</span><br><span class="line">&#125;</span><br><span class="line">fireCustomEvent(<span class="string">&#x27;你好，我是普通JS！&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><code>content-script.js</code>中：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> hiddenDiv = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;myCustomEventDiv&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span>(!hiddenDiv) &#123;</span><br><span class="line">	hiddenDiv = <span class="built_in">document</span>.createElement(<span class="string">&#x27;div&#x27;</span>);</span><br><span class="line">	hiddenDiv.style.display = <span class="string">&#x27;none&#x27;</span>;</span><br><span class="line">	<span class="built_in">document</span>.body.appendChild(hiddenDiv);</span><br><span class="line">&#125;</span><br><span class="line">hiddenDiv.addEventListener(<span class="string">&#x27;myCustomEvent&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">var</span> eventData = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;myCustomEventDiv&#x27;</span>).innerText;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">&#x27;收到自定义事件消息：&#x27;</span> + eventData);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="长连接和短连接"><a href="#长连接和短连接" class="headerlink" title="长连接和短连接"></a>长连接和短连接</h2><p>其实上面已经涉及到了，这里再单独说明一下。Chrome插件中有2种通信方式，一个是短连接（<code>chrome.tabs.sendMessage</code>和<code>chrome.runtime.sendMessage</code>），一个是长连接（<code>chrome.tabs.connect</code>和<code>chrome.runtime.connect</code>）。</p>
<p>短连接的话就是挤牙膏一样，我发送一下，你收到了再回复一下，如果对方不回复，你只能重新发，而长连接类似<code>WebSocket</code>会一直建立连接，双方可以随时互发消息。</p>
<p>短连接上面已经有代码示例了，这里只讲一下长连接。</p>
<p>popup.js：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">getCurrentTabId(<span class="function">(<span class="params">tabId</span>) =&gt;</span> &#123;</span><br><span class="line">	<span class="keyword">var</span> port = chrome.tabs.connect(tabId, &#123;<span class="attr">name</span>: <span class="string">&#x27;test-connect&#x27;</span>&#125;);</span><br><span class="line">	port.postMessage(&#123;<span class="attr">question</span>: <span class="string">&#x27;你是谁啊？&#x27;</span>&#125;);</span><br><span class="line">	port.onMessage.addListener(<span class="function"><span class="keyword">function</span>(<span class="params">msg</span>) </span>&#123;</span><br><span class="line">		alert(<span class="string">&#x27;收到消息：&#x27;</span>+msg.answer);</span><br><span class="line">		<span class="keyword">if</span>(msg.answer &amp;&amp; msg.answer.startsWith(<span class="string">&#x27;我是&#x27;</span>))</span><br><span class="line">		&#123;</span><br><span class="line">			port.postMessage(&#123;<span class="attr">question</span>: <span class="string">&#x27;哦，原来是你啊！&#x27;</span>&#125;);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>content-script.js：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 监听长连接</span></span><br><span class="line">chrome.runtime.onConnect.addListener(<span class="function"><span class="keyword">function</span>(<span class="params">port</span>) </span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(port);</span><br><span class="line">	<span class="keyword">if</span>(port.name == <span class="string">&#x27;test-connect&#x27;</span>) &#123;</span><br><span class="line">		port.onMessage.addListener(<span class="function"><span class="keyword">function</span>(<span class="params">msg</span>) </span>&#123;</span><br><span class="line">			<span class="built_in">console</span>.log(<span class="string">&#x27;收到长连接消息：&#x27;</span>, msg);</span><br><span class="line">			<span class="keyword">if</span>(msg.question == <span class="string">&#x27;你是谁啊？&#x27;</span>) port.postMessage(&#123;<span class="attr">answer</span>: <span class="string">&#x27;我是你爸！&#x27;</span>&#125;);</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h1 id="其它补充"><a href="#其它补充" class="headerlink" title="其它补充"></a>其它补充</h1><h2 id="动态注入或执行JS"><a href="#动态注入或执行JS" class="headerlink" title="动态注入或执行JS"></a>动态注入或执行JS</h2><p>虽然在<code>background</code>和<code>popup</code>中无法直接访问页面DOM，但是可以通过<code>chrome.tabs.executeScript</code>来执行脚本，从而实现访问web页面的DOM（注意，这种方式也不能直接访问页面JS）。</p>
<p>示例<code>manifest.json</code>配置：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;name&quot;</span>: <span class="string">&quot;动态JS注入演示&quot;</span>,</span><br><span class="line">	...</span><br><span class="line">	<span class="string">&quot;permissions&quot;</span>: [</span><br><span class="line">		<span class="string">&quot;tabs&quot;</span>, <span class="string">&quot;http://*/*&quot;</span>, <span class="string">&quot;https://*/*&quot;</span></span><br><span class="line">	],</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>JS：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 动态执行JS代码</span></span><br><span class="line">chrome.tabs.executeScript(tabId, &#123;<span class="attr">code</span>: <span class="string">&#x27;document.body.style.backgroundColor=&quot;red&quot;&#x27;</span>&#125;);</span><br><span class="line"><span class="comment">// 动态执行JS文件</span></span><br><span class="line">chrome.tabs.executeScript(tabId, &#123;<span class="attr">file</span>: <span class="string">&#x27;some-script.js&#x27;</span>&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="动态注入CSS"><a href="#动态注入CSS" class="headerlink" title="动态注入CSS"></a>动态注入CSS</h2><p>示例<code>manifest.json</code>配置：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;name&quot;</span>: <span class="string">&quot;动态CSS注入演示&quot;</span>,</span><br><span class="line">	...</span><br><span class="line">	<span class="string">&quot;permissions&quot;</span>: [</span><br><span class="line">		<span class="string">&quot;tabs&quot;</span>, <span class="string">&quot;http://*/*&quot;</span>, <span class="string">&quot;https://*/*&quot;</span></span><br><span class="line">	],</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>JS代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 动态执行CSS代码，TODO，这里有待验证</span></span><br><span class="line">chrome.tabs.insertCSS(tabId, &#123;<span class="attr">code</span>: <span class="string">&#x27;xxx&#x27;</span>&#125;);</span><br><span class="line"><span class="comment">// 动态执行CSS文件</span></span><br><span class="line">chrome.tabs.insertCSS(tabId, &#123;<span class="attr">file</span>: <span class="string">&#x27;some-style.css&#x27;</span>&#125;);</span><br></pre></td></tr></table></figure>


<h2 id="获取当前窗口ID"><a href="#获取当前窗口ID" class="headerlink" title="获取当前窗口ID"></a>获取当前窗口ID</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">chrome.windows.getCurrent(<span class="function"><span class="keyword">function</span>(<span class="params">currentWindow</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">&#x27;当前窗口ID：&#x27;</span> + currentWindow.id);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="获取当前标签页ID"><a href="#获取当前标签页ID" class="headerlink" title="获取当前标签页ID"></a>获取当前标签页ID</h2><p>一般有2种方法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取当前选项卡ID</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getCurrentTabId</span>(<span class="params">callback</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	chrome.tabs.query(&#123;<span class="attr">active</span>: <span class="literal">true</span>, <span class="attr">currentWindow</span>: <span class="literal">true</span>&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">tabs</span>)</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(callback) callback(tabs.length ? tabs[<span class="number">0</span>].id: <span class="literal">null</span>);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>获取当前选项卡id的另一种方法，大部分时候都类似，只有少部分时候会不一样（例如当窗口最小化时）</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取当前选项卡ID</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getCurrentTabId2</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	chrome.windows.getCurrent(<span class="function"><span class="keyword">function</span>(<span class="params">currentWindow</span>)</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		chrome.tabs.query(&#123;<span class="attr">active</span>: <span class="literal">true</span>, <span class="attr">windowId</span>: currentWindow.id&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">tabs</span>)</span></span><br><span class="line"><span class="function">		</span>&#123;</span><br><span class="line">			<span class="keyword">if</span>(callback) callback(tabs.length ? tabs[<span class="number">0</span>].id: <span class="literal">null</span>);</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="本地存储"><a href="#本地存储" class="headerlink" title="本地存储"></a>本地存储</h2><p>本地存储建议用<code>chrome.storage</code>而不是普通的<code>localStorage</code>，区别有好几点，个人认为最重要的2点区别是：</p>
<ul>
<li><code>chrome.storage</code>是针对插件全局的，即使你在<code>background</code>中保存的数据，在<code>content-script</code>也能获取到；</li>
<li><code>chrome.storage.sync</code>可以跟随当前登录用户自动同步，这台电脑修改的设置会自动同步到其它电脑，很方便，如果没有登录或者未联网则先保存到本地，等登录了再同步至网络；</li>
</ul>
<p>需要声明<code>storage</code>权限，有<code>chrome.storage.sync</code>和<code>chrome.storage.local</code>2种方式可供选择，使用示例如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 读取数据，第一个参数是指定要读取的key以及设置默认值</span></span><br><span class="line">chrome.storage.sync.get(&#123;<span class="attr">color</span>: <span class="string">&#x27;red&#x27;</span>, <span class="attr">age</span>: <span class="number">18</span>&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">items</span>) </span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(items.color, items.age);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 保存数据</span></span><br><span class="line">chrome.storage.sync.set(&#123;<span class="attr">color</span>: <span class="string">&#x27;blue&#x27;</span>&#125;, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">&#x27;保存成功！&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="webRequest"><a href="#webRequest" class="headerlink" title="webRequest"></a>webRequest</h2><p>通过webRequest系列API可以对HTTP请求进行任性地修改、定制，这里通过<code>beforeRequest</code>来简单演示一下它的冰山一角：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//manifest.json</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">// 权限申请</span></span><br><span class="line">	<span class="string">&quot;permissions&quot;</span>:</span><br><span class="line">	[</span><br><span class="line">		<span class="string">&quot;webRequest&quot;</span>, <span class="comment">// web请求</span></span><br><span class="line">		<span class="string">&quot;webRequestBlocking&quot;</span>, <span class="comment">// 阻塞式web请求</span></span><br><span class="line">		<span class="string">&quot;storage&quot;</span>, <span class="comment">// 插件本地存储</span></span><br><span class="line">		<span class="string">&quot;http://*/*&quot;</span>, <span class="comment">// 可以通过executeScript或者insertCSS访问的网站</span></span><br><span class="line">		<span class="string">&quot;https://*/*&quot;</span> <span class="comment">// 可以通过executeScript或者insertCSS访问的网站</span></span><br><span class="line">	],</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// background.js</span></span><br><span class="line"><span class="comment">// 是否显示图片</span></span><br><span class="line"><span class="keyword">var</span> showImage;</span><br><span class="line">chrome.storage.sync.get(&#123;<span class="attr">showImage</span>: <span class="literal">true</span>&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">items</span>) </span>&#123;</span><br><span class="line">	showImage = items.showImage;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// web请求监听，最后一个参数表示阻塞式，需单独声明权限：webRequestBlocking</span></span><br><span class="line">chrome.webRequest.onBeforeRequest.addListener(<span class="function"><span class="params">details</span> =&gt;</span> &#123;</span><br><span class="line">	<span class="comment">// cancel 表示取消本次请求</span></span><br><span class="line">	<span class="keyword">if</span>(!showImage &amp;&amp; details.type == <span class="string">&#x27;image&#x27;</span>) <span class="keyword">return</span> &#123;<span class="attr">cancel</span>: <span class="literal">true</span>&#125;;</span><br><span class="line">	<span class="comment">// 简单的音视频检测</span></span><br><span class="line">	<span class="comment">// 大部分网站视频的type并不是media，且视频做了防下载处理，所以这里仅仅是为了演示效果，无实际意义</span></span><br><span class="line">	<span class="keyword">if</span>(details.type == <span class="string">&#x27;media&#x27;</span>) &#123;</span><br><span class="line">		chrome.notifications.create(<span class="literal">null</span>, &#123;</span><br><span class="line">			type: <span class="string">&#x27;basic&#x27;</span>,</span><br><span class="line">			iconUrl: <span class="string">&#x27;img/icon.png&#x27;</span>,</span><br><span class="line">			title: <span class="string">&#x27;检测到音视频&#x27;</span>,</span><br><span class="line">			message: <span class="string">&#x27;音视频地址：&#x27;</span> + details.url,</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;, &#123;<span class="attr">urls</span>: [<span class="string">&quot;&lt;all_urls&gt;&quot;</span>]&#125;, [<span class="string">&quot;blocking&quot;</span>]);</span><br></pre></td></tr></table></figure>

<h2 id="国际化"><a href="#国际化" class="headerlink" title="国际化"></a>国际化</h2><p>插件根目录新建一个名为<code>_locales</code>的文件夹，再在下面新建一些语言的文件夹，如<code>en</code>、<code>zh_CN</code>、<code>zh_TW</code>，然后再在每个文件夹放入一个<code>messages.json</code>，同时必须在清单文件中设置<code>default_locale</code>。</p>
<p><code>_locales\en\messages.json</code>内容：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;pluginDesc&quot;</span>: &#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;A simple chrome extension demo&quot;</span>&#125;,</span><br><span class="line">	<span class="string">&quot;helloWorld&quot;</span>: &#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;Hello World!&quot;</span>&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>_locales\zh_CN\messages.json</code>内容：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;pluginDesc&quot;</span>: &#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;一个简单的Chrome插件demo&quot;</span>&#125;,</span><br><span class="line">	<span class="string">&quot;helloWorld&quot;</span>: &#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;你好啊，世界！&quot;</span>&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在<code>manifest.json</code>和<code>CSS</code>文件中通过<code>__MSG_messagename__</code>引入，如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;description&quot;</span>: <span class="string">&quot;__MSG_pluginDesc__&quot;</span>,</span><br><span class="line">	<span class="comment">// 默认语言</span></span><br><span class="line">	<span class="string">&quot;default_locale&quot;</span>: <span class="string">&quot;zh_CN&quot;</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>JS中则直接<code>chrome.i18n.getMessage(&quot;helloWorld&quot;)</code>。</p>
<p>测试时，通过给chrome建立一个不同的快捷方式<code>chrome.exe --lang=en</code>来切换语言，如：</p>
<p><img src="http://image.liuxianan.com/201706/20170621_180606_759_2394.png"></p>
<p>英文效果：</p>
<p><img src="http://image.liuxianan.com/201706/20170621_175733_172_5903.png"></p>
<p>中文效果：</p>
<p><img src="http://image.liuxianan.com/201706/20170621_175621_269_0466.png"></p>
<h2 id="API总结"><a href="#API总结" class="headerlink" title="API总结"></a>API总结</h2><p>比较常用用的一些API系列：</p>
<ul>
<li>chrome.tabs</li>
<li>chrome.runtime</li>
<li>chrome.webRequest</li>
<li>chrome.window</li>
<li>chrome.storage</li>
<li>chrome.contextMenus</li>
<li>chrome.devtools</li>
<li>chrome.extension</li>
</ul>
<h1 id="经验总结"><a href="#经验总结" class="headerlink" title="经验总结"></a>经验总结</h1><h2 id="查看已安装插件路径"><a href="#查看已安装插件路径" class="headerlink" title="查看已安装插件路径"></a>查看已安装插件路径</h2><p>已安装的插件源码路径：<code>C:\Users\用户名\AppData\Local\Google\Chrome\User Data\Default\Extensions</code>，每一个插件被放在以插件ID为名的文件夹里面，想要学习某个插件的某个功能是如何实现的，看人家的源码是最好的方法了：</p>
<p><img src="http://image.liuxianan.com/201706/20170601_100200_647_6507.png"></p>
<p>如何查看某个插件的ID？进入 chrome://extensions ，然后勾线开发者模式即可看到了。</p>
<p><img src="http://image.liuxianan.com/201706/20170601_100408_338_3095.png"></p>
<h2 id="特别注意background的报错"><a href="#特别注意background的报错" class="headerlink" title="特别注意background的报错"></a>特别注意background的报错</h2><p>很多时候你发现你的代码会莫名其妙的失效，找来找去又找不到原因，这时打开background的控制台才发现原来某个地方写错了导致代码没生效，正式由于background报错的隐蔽性(需要主动打开对应的控制台才能看到错误)，所以特别注意这点。</p>
<h2 id="如何让popup页面不关闭"><a href="#如何让popup页面不关闭" class="headerlink" title="如何让popup页面不关闭"></a>如何让popup页面不关闭</h2><p>在对popup页面审查元素的时候popup会被强制打开无法关闭，只有控制台关闭了才可以关闭popup，原因很简单：如果popup关闭了控制台就没用了。这种方法在某些情况下很实用！</p>
<h2 id="不支持内联JavaScript的执行"><a href="#不支持内联JavaScript的执行" class="headerlink" title="不支持内联JavaScript的执行"></a>不支持内联JavaScript的执行</h2><p>也就是不支持将js直接写在html中，比如：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;btn&quot;</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;收藏&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;test()&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>报错如下：</p>
<pre><code>Refused to execute inline event handler because it violates the following Content Security Policy directive: &quot;script-src &#39;self&#39; blob: filesystem: chrome-extension-resource:&quot;. Either the &#39;unsafe-inline&#39; keyword, a hash (&#39;sha256-...&#39;), or a nonce (&#39;nonce-...&#39;) is required to enable inline execution.</code></pre>
<p>解决方法就是用JS绑定事件：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&#x27;#btn&#x27;</span>).on(<span class="string">&#x27;click&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;alert(<span class="string">&#x27;测试&#x27;</span>)&#125;);</span><br></pre></td></tr></table></figure>

<p>另外，对于A标签，这样写<code>href=&quot;javascript:;&quot;</code>然后用JS绑定事件虽然控制台会报错，但是不受影响，当然强迫症患者受不了的话只能写成<code>href=&quot;#&quot;</code>了。</p>
<p>如果这样写：</p>
<pre><code>&lt;a href=&quot;javascript:;&quot; id=&quot;get_secret&quot;&gt;请求secret&lt;/a&gt;</code></pre>
<p>报错如下：</p>
<pre><code>Refused to execute JavaScript URL because it violates the following Content Security Policy directive: &quot;script-src &#39;self&#39; blob: filesystem: chrome-extension-resource:&quot;. Either the &#39;unsafe-inline&#39; keyword, a hash (&#39;sha256-...&#39;), or a nonce (&#39;nonce-...&#39;) is required to enable inline execution.</code></pre>
<h2 id="注入CSS的时候必须小心"><a href="#注入CSS的时候必须小心" class="headerlink" title="注入CSS的时候必须小心"></a>注入CSS的时候必须小心</h2><p>由于通过<code>content_scripts</code>注入的CSS优先级非常高，几乎仅次于浏览器默认样式，稍不注意可能就会影响一些网站的展示效果，所以尽量不要写一些影响全局的样式。</p>
<p>之所以强调这个，是因为这个带来的问题非常隐蔽，不太容易找到，可能你正在写某个网页，昨天样式还是好好的，怎么今天就突然不行了？然后你辛辛苦苦找来找去，找了半天才发现竟然是因为插件里面的一个样式影响的！</p>
<p><img src="http://image.liuxianan.com/201706/20170620_175530_598_9800.png"></p>
<h1 id="打包与发布"><a href="#打包与发布" class="headerlink" title="打包与发布"></a>打包与发布</h1><p>打包的话直接在插件管理页有一个打包按钮：</p>
<p><img src="http://image.liuxianan.com/201706/20170621_181130_362_3360.png"></p>
<p>然后会生成一个<code>.crx</code>文件，要发布到Google应用商店的话需要先登录你的Google账号，然后花5个$注册为开发者，本人太穷，就懒得亲自验证了，有发布需求的自己去整吧。</p>
<p><img src="http://image.liuxianan.com/201707/20170710_221653_875_3099.png"></p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><h2 id="官方资料"><a href="#官方资料" class="headerlink" title="官方资料"></a>官方资料</h2><p>推荐查看官方文档，虽然是英文，但是全且新，国内的中文资料都比较旧（注意以下全部需要翻墙）：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://developer.chrome.com/extensions">Chrome插件官方文档主页</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.chrome.com/extensions/samples">Chrome插件官方示例</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.chrome.com/extensions/manifest">manifest清单文件</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.chrome.com/extensions/permissions">permissions权限</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.chrome.com/extensions/api_index">chrome.xxx.api文档</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.chrome.com/extensions/match_patterns">模糊匹配规则语法详解</a></li>
</ul>
<h2 id="第三方资料"><a href="#第三方资料" class="headerlink" title="第三方资料"></a>第三方资料</h2><p>部分中文资料，不是特别推荐：</p>
<ul>
<li><a target="_blank" rel="noopener" href="http://open.se.360.cn/open/extension_dev/overview.html">360安全浏览器开发文档</a></li>
<li><a target="_blank" rel="noopener" href="http://open.chrome.360.cn/extension_dev/overview.html">360极速浏览器Chrome扩展开发文档</a></li>
<li><a target="_blank" rel="noopener" href="http://www.cnblogs.com/champagne/p/">Chrome扩展开发极客系列博客</a></li>
</ul>
<h2 id="附图"><a href="#附图" class="headerlink" title="附图"></a>附图</h2><p>附图：Chrome高清png格式logo：</p>
<p><img src="http://image.liuxianan.com/201706/20170619_113331_710_1132.png"></p>
</div><div class="article-licensing box"><div class="licensing-title"><p>【干货】Chrome插件(扩展)开发全攻略</p><p><a href="http://yoursite.com/2020/12/30/%E3%80%90%E5%B9%B2%E8%B4%A7%E3%80%91Chrome%E6%8F%92%E4%BB%B6(%E6%89%A9%E5%B1%95)%E5%BC%80%E5%8F%91%E5%85%A8%E6%94%BB%E7%95%A5/">http://yoursite.com/2020/12/30/%E3%80%90%E5%B9%B2%E8%B4%A7%E3%80%91Chrome%E6%8F%92%E4%BB%B6(%E6%89%A9%E5%B1%95)%E5%BC%80%E5%8F%91%E5%85%A8%E6%94%BB%E7%95%A5/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>作者</h6><p>蛋清小记</p></div></div><div class="level-item is-narrow"><div><h6>发布于</h6><p>2020-12-30</p></div></div><div class="level-item is-narrow"><div><h6>更新于</h6><p>2020-12-30</p></div></div><div class="level-item is-narrow"><div><h6>许可协议</h6><p><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a class="icon" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a><a class="icon" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags size-small mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/%E8%B7%A8%E5%9F%9F/">跨域</a></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2020/12/30/%E5%BD%BB%E5%BA%95%E6%90%9E%E6%87%82%20MySQL%20%E4%BA%8B%E5%8A%A1%E7%9A%84%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">彻底搞懂 MySQL 事务的隔离级别</span></a></div></nav><!--!--></div><!--!--><div class="column column-right is-4-tablet is-4-desktop is-4-widescreen  order-3 is-sticky"><div class="card widget" id="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">目录</h3><ul class="menu-list"><li><a class="is-flex" href="#写在前面"><span class="mr-2">1</span><span>写在前面</span></a><ul class="menu-list"><li><a class="is-flex" href="#仓库说明"><span class="mr-2">1.1</span><span>仓库说明</span></a></li></ul></li><li><a class="is-flex" href="#前言"><span class="mr-2">2</span><span>前言</span></a><ul class="menu-list"><li><a class="is-flex" href="#什么是Chrome插件"><span class="mr-2">2.1</span><span>什么是Chrome插件</span></a></li><li><a class="is-flex" href="#学习Chrome插件开发有什么意义"><span class="mr-2">2.2</span><span>学习Chrome插件开发有什么意义</span></a></li><li><a class="is-flex" href="#为什么是Chrome插件而不是Firefox插件"><span class="mr-2">2.3</span><span>为什么是Chrome插件而不是Firefox插件</span></a></li></ul></li><li><a class="is-flex" href="#开发与调试"><span class="mr-2">3</span><span>开发与调试</span></a></li><li><a class="is-flex" href="#核心介绍"><span class="mr-2">4</span><span>核心介绍</span></a><ul class="menu-list"><li><a class="is-flex" href="#manifest-json"><span class="mr-2">4.1</span><span>manifest.json</span></a></li><li><a class="is-flex" href="#content-scripts"><span class="mr-2">4.2</span><span>content-scripts</span></a></li><li><a class="is-flex" href="#background"><span class="mr-2">4.3</span><span>background</span></a></li><li><a class="is-flex" href="#event-pages"><span class="mr-2">4.4</span><span>event-pages</span></a></li><li><a class="is-flex" href="#popup"><span class="mr-2">4.5</span><span>popup</span></a></li><li><a class="is-flex" href="#injected-script"><span class="mr-2">4.6</span><span>injected-script</span></a></li><li><a class="is-flex" href="#homepage-url"><span class="mr-2">4.7</span><span>homepage_url</span></a></li></ul></li><li><a class="is-flex" href="#Chrome插件的8种展示形式"><span class="mr-2">5</span><span>Chrome插件的8种展示形式</span></a><ul class="menu-list"><li><a class="is-flex" href="#browserAction-浏览器右上角"><span class="mr-2">5.1</span><span>browserAction(浏览器右上角)</span></a><ul class="menu-list"><li><a class="is-flex" href="#图标"><span class="mr-2">5.1.1</span><span>图标</span></a></li><li><a class="is-flex" href="#tooltip"><span class="mr-2">5.1.2</span><span>tooltip</span></a></li><li><a class="is-flex" href="#badge"><span class="mr-2">5.1.3</span><span>badge</span></a></li></ul></li><li><a class="is-flex" href="#pageAction-地址栏右侧"><span class="mr-2">5.2</span><span>pageAction(地址栏右侧)</span></a></li><li><a class="is-flex" href="#右键菜单"><span class="mr-2">5.3</span><span>右键菜单</span></a><ul class="menu-list"><li><a class="is-flex" href="#最简单的右键菜单示例"><span class="mr-2">5.3.1</span><span>最简单的右键菜单示例</span></a></li><li><a class="is-flex" href="#添加右键百度搜索"><span class="mr-2">5.3.2</span><span>添加右键百度搜索</span></a></li><li><a class="is-flex" href="#语法说明"><span class="mr-2">5.3.3</span><span>语法说明</span></a></li></ul></li><li><a class="is-flex" href="#override-覆盖特定页面"><span class="mr-2">5.4</span><span>override(覆盖特定页面)</span></a></li><li><a class="is-flex" href="#devtools-开发者工具"><span class="mr-2">5.5</span><span>devtools(开发者工具)</span></a><ul class="menu-list"><li><a class="is-flex" href="#预热"><span class="mr-2">5.5.1</span><span>预热</span></a></li><li><a class="is-flex" href="#devtools扩展介绍"><span class="mr-2">5.5.2</span><span>devtools扩展介绍</span></a></li><li><a class="is-flex" href="#实例：创建一个devtools扩展"><span class="mr-2">5.5.3</span><span>实例：创建一个devtools扩展</span></a></li><li><a class="is-flex" href="#调试技巧"><span class="mr-2">5.5.4</span><span>调试技巧</span></a></li></ul></li><li><a class="is-flex" href="#option-选项页"><span class="mr-2">5.6</span><span>option(选项页)</span></a></li><li><a class="is-flex" href="#omnibox"><span class="mr-2">5.7</span><span>omnibox</span></a></li><li><a class="is-flex" href="#桌面通知"><span class="mr-2">5.8</span><span>桌面通知</span></a></li></ul></li><li><a class="is-flex" href="#5种类型的JS对比"><span class="mr-2">6</span><span>5种类型的JS对比</span></a><ul class="menu-list"><li><a class="is-flex" href="#权限对比"><span class="mr-2">6.1</span><span>权限对比</span></a></li><li><a class="is-flex" href="#调试方式对比"><span class="mr-2">6.2</span><span>调试方式对比</span></a></li></ul></li><li><a class="is-flex" href="#消息通信"><span class="mr-2">7</span><span>消息通信</span></a><ul class="menu-list"><li><a class="is-flex" href="#互相通信概览"><span class="mr-2">7.1</span><span>互相通信概览</span></a></li><li><a class="is-flex" href="#通信详细介绍"><span class="mr-2">7.2</span><span>通信详细介绍</span></a><ul class="menu-list"><li><a class="is-flex" href="#popup和background"><span class="mr-2">7.2.1</span><span>popup和background</span></a></li><li><a class="is-flex" href="#popup或者bg向content主动发送消息"><span class="mr-2">7.2.2</span><span>popup或者bg向content主动发送消息</span></a></li><li><a class="is-flex" href="#content-script主动发消息给后台"><span class="mr-2">7.2.3</span><span>content-script主动发消息给后台</span></a></li><li><a class="is-flex" href="#injected-script和content-script"><span class="mr-2">7.2.4</span><span>injected script和content-script</span></a></li></ul></li><li><a class="is-flex" href="#长连接和短连接"><span class="mr-2">7.3</span><span>长连接和短连接</span></a></li></ul></li><li><a class="is-flex" href="#其它补充"><span class="mr-2">8</span><span>其它补充</span></a><ul class="menu-list"><li><a class="is-flex" href="#动态注入或执行JS"><span class="mr-2">8.1</span><span>动态注入或执行JS</span></a></li><li><a class="is-flex" href="#动态注入CSS"><span class="mr-2">8.2</span><span>动态注入CSS</span></a></li><li><a class="is-flex" href="#获取当前窗口ID"><span class="mr-2">8.3</span><span>获取当前窗口ID</span></a></li><li><a class="is-flex" href="#获取当前标签页ID"><span class="mr-2">8.4</span><span>获取当前标签页ID</span></a></li><li><a class="is-flex" href="#本地存储"><span class="mr-2">8.5</span><span>本地存储</span></a></li><li><a class="is-flex" href="#webRequest"><span class="mr-2">8.6</span><span>webRequest</span></a></li><li><a class="is-flex" href="#国际化"><span class="mr-2">8.7</span><span>国际化</span></a></li><li><a class="is-flex" href="#API总结"><span class="mr-2">8.8</span><span>API总结</span></a></li></ul></li><li><a class="is-flex" href="#经验总结"><span class="mr-2">9</span><span>经验总结</span></a><ul class="menu-list"><li><a class="is-flex" href="#查看已安装插件路径"><span class="mr-2">9.1</span><span>查看已安装插件路径</span></a></li><li><a class="is-flex" href="#特别注意background的报错"><span class="mr-2">9.2</span><span>特别注意background的报错</span></a></li><li><a class="is-flex" href="#如何让popup页面不关闭"><span class="mr-2">9.3</span><span>如何让popup页面不关闭</span></a></li><li><a class="is-flex" href="#不支持内联JavaScript的执行"><span class="mr-2">9.4</span><span>不支持内联JavaScript的执行</span></a></li><li><a class="is-flex" href="#注入CSS的时候必须小心"><span class="mr-2">9.5</span><span>注入CSS的时候必须小心</span></a></li></ul></li><li><a class="is-flex" href="#打包与发布"><span class="mr-2">10</span><span>打包与发布</span></a></li><li><a class="is-flex" href="#参考"><span class="mr-2">11</span><span>参考</span></a><ul class="menu-list"><li><a class="is-flex" href="#官方资料"><span class="mr-2">11.1</span><span>官方资料</span></a></li><li><a class="is-flex" href="#第三方资料"><span class="mr-2">11.2</span><span>第三方资料</span></a></li><li><a class="is-flex" href="#附图"><span class="mr-2">11.3</span><span>附图</span></a></li></ul></li></ul></div></div><style>.menu-list > li > a.is-active + .menu-list { display: block; }.menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div><div class="card widget"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><a class="media-left" href="/2020/12/30/1.%E6%9C%BA%E5%99%A8%E8%AF%AD%E8%A8%80%E4%B8%8E%E6%9C%BA%E5%99%A8%E6%8C%87%E4%BB%A4/"><p class="image is-64x64"><img class="fill" src="https://blog.zhangruipeng.me/hexo-theme-icarus/gallery/covers/vector_landscape_1.svg" alt="1.机器语言与机器指令"></p></a><div class="media-content size-small"><p><time dateTime="2020-12-30T07:06:44.525Z">2020-12-30</time></p><p class="title is-6"><a class="link-muted" href="/2020/12/30/1.%E6%9C%BA%E5%99%A8%E8%AF%AD%E8%A8%80%E4%B8%8E%E6%9C%BA%E5%99%A8%E6%8C%87%E4%BB%A4/">1.机器语言与机器指令</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80/">汇编语言</a></p></div></article><article class="media"><a class="media-left" href="/2020/12/30/2.%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9A%84%E7%BB%84%E6%88%90/"><p class="image is-64x64"><img class="fill" src="https://blog.zhangruipeng.me/hexo-theme-icarus/gallery/covers/vector_landscape_1.svg" alt="2.计算机的组成"></p></a><div class="media-content size-small"><p><time dateTime="2020-12-30T07:06:44.525Z">2020-12-30</time></p><p class="title is-6"><a class="link-muted" href="/2020/12/30/2.%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9A%84%E7%BB%84%E6%88%90/">2.计算机的组成</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80/">汇编语言</a></p></div></article><article class="media"><a class="media-left" href="/2020/12/30/3.%E5%86%85%E5%AD%98%E8%AF%BB%E5%86%99%E4%B8%8E%E5%86%85%E5%AD%98%E7%A9%BA%E9%97%B4/"><p class="image is-64x64"><img class="fill" src="https://blog.zhangruipeng.me/hexo-theme-icarus/gallery/covers/vector_landscape_1.svg" alt="3.内存读写与内存空间"></p></a><div class="media-content size-small"><p><time dateTime="2020-12-30T07:06:44.525Z">2020-12-30</time></p><p class="title is-6"><a class="link-muted" href="/2020/12/30/3.%E5%86%85%E5%AD%98%E8%AF%BB%E5%86%99%E4%B8%8E%E5%86%85%E5%AD%98%E7%A9%BA%E9%97%B4/">3.内存读写与内存空间</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80/">汇编语言</a></p></div></article><article class="media"><a class="media-left" href="/2020/12/30/4.%E5%AF%84%E5%AD%98%E5%99%A8%E5%8F%8A%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8/"><p class="image is-64x64"><img class="fill" src="https://blog.zhangruipeng.me/hexo-theme-icarus/gallery/covers/vector_landscape_1.svg" alt="4.寄存器与数据存储"></p></a><div class="media-content size-small"><p><time dateTime="2020-12-30T07:06:44.525Z">2020-12-30</time></p><p class="title is-6"><a class="link-muted" href="/2020/12/30/4.%E5%AF%84%E5%AD%98%E5%99%A8%E5%8F%8A%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8/">4.寄存器与数据存储</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80/">汇编语言</a></p></div></article><article class="media"><a class="media-left" href="/2020/12/30/5.MOV%E5%92%8CADD%E6%8C%87%E4%BB%A4/"><p class="image is-64x64"><img class="fill" src="https://blog.zhangruipeng.me/hexo-theme-icarus/gallery/covers/vector_landscape_1.svg" alt="6.MOV和ADD指令"></p></a><div class="media-content size-small"><p><time dateTime="2020-12-30T07:06:44.525Z">2020-12-30</time></p><p class="title is-6"><a class="link-muted" href="/2020/12/30/5.MOV%E5%92%8CADD%E6%8C%87%E4%BB%A4/">6.MOV和ADD指令</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80/">汇编语言</a></p></div></article></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/categories/Chrome%E6%8F%92%E4%BB%B6/"><span class="level-start"><span class="level-item">Chrome插件</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"><span class="level-start"><span class="level-item">数据库</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80/"><span class="level-start"><span class="level-item">汇编语言</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/Mysql/"><span class="tag">Mysql</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"><span class="tag">数据库</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%8B%E5%8A%A1/"><span class="tag">数据库事务</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%B1%87%E7%BC%96%E6%8C%87%E4%BB%A4/"><span class="tag">汇编指令</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80/"><span class="tag">汇编语言</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E8%B7%A8%E5%9F%9F/"><span class="tag">跨域</span><span class="tag is-grey-lightest">1</span></a></div></div></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="蛋清小记" height="28"></a><p class="size-small"><span>&copy; 2020 蛋清小记</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            site: {
                url: 'http://yoursite.com',
                external_link: {"enable":true,"exclude":[]}
            },
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>